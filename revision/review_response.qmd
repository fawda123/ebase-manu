---
format: 
  docx:
    reference-doc: response_styles.docx
bibliography: ../refs.bib
csl: ../limnology-and-oceanography.csl

execute: 
  echo: false
  warning: false
  message: false
---

```{r}
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(readr)
```

```{r}
#| eval: false
spelling::spell_check_files(here::here('revision/review-response.qmd'))
```

*We thank all three reviewers for providing thorough and constructive comments that have helped to improve the manuscript. Our responses to each of these comments are provided below. Note that line numbers refer to those in the original manuscript.*

### Reviewer 1

This manuscript describes an advancement in the computation of aquatic estuarine metabolism (i.e., primary production and reparation) using open-water dissolved oxygen (DO) time series. The authors adapted a Bayesian model originally developed for non-tidal, lotic systems (i.e., BASE) to 1) now work with time series that have missing dissolved oxygen observations and 2) can accommodate longer time periods for metabolism estimates. The latter could produce non- real estimates of metabolism in earlier methods while the former is achieved through linear interpolation during pre-processing and estimate removal by a user defined threshold during post-processing. The authors describe in sufficient detail how to operationalize the model and provide a comparison with a historically more standard arithmetic-based model that has been used in earlier studies of estuarine metabolism. Furthermore, the authors provide an R package “EBASE” to allow others to estimate estuarine metabolism using this method advancement; a package I am sure the coastal community will find useful. Overall, this paper was well written and the advancement significant. This paper should be considered for publication in L&O Methods following incorporation of the comments below.

*Response: Thank you for providing these thorough comments on our manuscript.  Please see our responses below.*

There were two studies cited in the introduction (Line 98) as having used Bayesian techniques to estimate aquatic metabolism in estuaries. Please elaborate on how the method described in this study is consistent with and/or different from those in the cited studies.

*Response: We agree this clarification is needed.  The first study [@ciavatta2008] actually did not use a Bayesian approach, rather it provided simultaneous estimation of the metabolic parameters using a conventional empirical model framework.  This reference to a Bayesian approach was in error and we have removed this citation from the introduction. @tassone2019 does provide a good example for comparison with our work and we elaborate on this in the revised text on line 105: "@tassone2019 adapted a Bayesian approach developed for streams [@appling2018] in an estuarine setting to estimate metabolic rates in the James River.  Although this approach demonstrated the utility of such an approach in estuaries, much of the core model structure developed for streams was unchanged and may not have been fully descriptive of fundamental processes influencing metabolism in open-water environments."*

*We then continue the justification for our use of BASE, adding the following:*

*Line 108: "The underlying model components can also easily be updated given the relatively simple format of the approach."*

*Line 115: "We focus on BASE given the relative simplicity and, therefore, ease of application compared to other stream-based Bayesian approaches [e.g., @appling2018]."*

*The streamMetabolizer package is a great contribution to the field, although our implicit goal of this work was to modify a readily accessible open source approach such as BASE for our needs.  The framework was easily extendable for our chosen gas-exchange method [@Wanninkhof14] and modification of the software functionality (i.e., user-chosen optimization period and dealing with data gaps).*

The authors describe pitfalls in their model, particularly when it comes to estimating the gas transfer velocity. Additionally, the authors provide evidence that sometimes the right answer (i.e., modeled DO time series, lines 349-352) can be achieved through incorrect processes. Similar issues have been described and addressed in the stream metabolism literature which was not cited or discussed in this study, please see Appling et al. 2018 - https://doi.org/10.1002/2017JG004140). Consider adding to the discussion how EBASE might incorporate these advancements to address these issues.

*Response: Thank you for pointing out this reference.  We have included an explicit mention of equifinality and a citation for @appling2018 on line 352.  Also please see our addition to the discussion on line 490.  This is described in full in response to the general comments from Reviewer 3.*

Detiding (i.e., removing the influence of tidal cycles on time series data) the DO time series substantially improved model estimates and therefore was recommended as a step prior to applying the model. However, it was not clear how the authors detided their time series (they used Weighted Regression but it is unclear how this method removes tidal influence from the predicted time series – see lines 400-402). Please add additional information on the detiding approach and which variables were detided (i.e., was only DO detided? Wouldn’t all water-related input variables, such as water temperature and salinity, need to be detided?).

*Response: The detiding approach used herein is thoroughly described in another L&O paper cited in the main text [@Beck15]. Describing this approach in detail is beyond the scope of the paper, although we have added some text for clarification. Also, the method has only been applied to dissolved oxygen data, so we have not used it for any of the remaining parameters. Clarification for both points has been added to line 399: "The results of this analysis return a predicted and detided dissolved oxygen time series, where the detided results are simply the predictions at average tidal height [see @Beck15 for details]. This method was only applied to dissolved oxygen since it has not been evaluated with any other parameters."*

How would your results be impacted by using different observed data collection frequencies such as every 5-min, 15-min, 1 hour?

*Response: The resolution of "continuous" monitoring data has not been evaluated in this study, although our guess is that more frequent sampling may produce more robust estimates. However, this may not matter given the time scales at which metabolism changes (i.e., \> 1 day). In our experience, estimates from the Odum open-water method are nearly identical using 15-minute or hourly samples. Not sure the same would apply for EBASE given the fundamental differences between the approaches. We have added a point in the discussion on line 541 that speaks to this question: "These hypotheses may also consider frequency of continuous monitoring (e.g., 15 minute vs hourly) and how this may influence the results, as this is currently unknown for EBASE."*

In my use of Bayesian models for estimating metabolism, with each model run you can get different metabolism estimates. This is due to the prior distribution space that the model can operate in. Is this something you have noticed with your model? If so, could you add a sentence somewhere explaining that a user should expect different modeled estimates with each model run?

*Response: Surprisingly, we have not encountered this issue with EBASE. Obviously the results depend on the prior distributions, which was the purpose of our sensitivity analysis, although we have not noticed slightly different results for different runs with the same priors. It is possible these differences are present, but small enough not to notice. We would hope that a user of this approach would be familiar enough with Bayesian and MCMC methods to expect these minor differences.*

Line 32-36: Estuaries are also significantly influenced by their freshwater end-members, consider adding ‘river’ to ‘…interface between land, river, ocean, and atmosphere’. Similarly consider incorporating rivers into ‘…transported from land to rivers to ocean…’.

*Response: Added.*

Line 47: Consider adding how materials are lost to the atmosphere, the sediments, and the ocean. For example, “…that are lost to the atmosphere (i.e., outgassing), the sediments (i.e., burial), and the ocean (i.e., advection).”.

*Response: Added.*

Line 48-50: Consider adding the underwater eddy covariance method to the list of methods for estimating aquatic metabolism. See Berg et al. 2022 (https://doi.org/10.1146/annurev-marine-042121-012329)

*Response: Added to the list, including the citation, "...use of inert gases, and aquatic eddy covariance (Kemp and Testa 2011; Staehr et al. 2011; Berg et al. 2022).*

Line 80: As written, it seems ‘assumptions’ should be singular, not plural (…can violate an assumption of the method…).

*Response: Corrected.*

Line 82: I appreciate that the sign of P and R estimates in the literature has been applied non- uniformly. However, I believe the convention is that P is positive (DO is produced) while R is negative (DO is consumed). Could you change the physically impossible statement to state negative P and positive R? Or add a sentence about why both values are described with a positive sign – this is somewhat described on line 236.

*Response: Yes, we agree the sign has not been consistently described in the literature. We have added clarifying text at the end of the paragraph: "Note that R is often expressed as a negative value indicating consumption of dissolved oxygen. Here and throughout, we express correct values of R as positive values given the metabolic model described below."*

Line 96: Add the word statistical between ‘Bayesian’ and ‘techniques’ (i.e., Bayesian statistical techniques…)

*Response: Added.*

Line 98: These two cited studies – Ciavatta et al. 2008; Tassone and Bukaveckas 2019 - have used Bayesian approaches to estimate estuarine metabolism; what makes them limited? How is the approach described in this manuscript different from these two earlier studies? Have those earlier two studies informed the model selection/development described in this manuscript?

*Response: Please see our response to your general comment above.*

Line 106: Curious why your method builds off BASE when there has been an updated Bayesian technique for stream metabolism that more accurately estimates uncertainty and reduces equifinality - please see Appling et al. (2018) cited above. Additionally, one of the sources cited above (Tassone and Bukaveckas 2019) used the updated Bayesian technique to estimate single- station estuarine metabolism.

*Response: Please see our response to your general comment above.*

Line 126: Presumably, EBASE produces daily metabolic estimates. What constitutes a day in EBASE? Is it from midnight to midnight the following day or from 4 am to 4 am?

*Response: The "metabolic" day in EBASE is midnight to midnight the following day. Clarifying text was added to line 182. In our experience, very similar estimates are obtained whether the day is defined midnight to midnight or some other period. This is especially true if the optimization period is greater than one day, as suggested in model application, i.e., lines 317 - 320, 523-525.*

Line 129-131: I normally see water column depth represented as Z not H. Should clarify if the values of P, R, and D are positive, negative or both.

*Response: The water column depth notation was changed to Z (including the documentation and code in EBASE). Clarification was added for P, R, and D on line 132: "Both $P$ and $R$ are expressed as positive values, whereas D can be positive (outgassing) or negative (ingassing)."*

Line 135: Consider making C = Cobs if it represents the observed DO concentration. If that is not what it represents, then will need to be described in text.

*Response: Yes, C represents observed dissolved oxygen concentration (as noted on line 132). We have retained C instead of using Cobs for simplicity in the model equations. Further, the addition of the model input/output table as requested by another reviewer helps clarify the input data.*

Line 181: Specifying the model optimization period is an advancement of the BASE model but is not described in text. What does ‘optimization’ mean? What are the implications of using 1 day, 7 days, 30 days, or the entire time series length on the output? If you use 7 days, do you only get weekly estimates of metabolism?

*Response: This was clarified in the text.*

*Line 181: "First, users can specify the model optimization period as the amount of time over which the unknown parameters are estimated from the Bayesian prior distributions (i.e., $a$, $R$, and $b$). The optimization period determines how much data are used to estimate each parameter. Only one estimate for each of $a$, $R$, and $b$ is returned for each optimization period as defined by the model, although $P$ and $D$ can vary continuously given the dependence on other inputs that can vary at each time step (e.g., $PAR$ and wind). The optimization period can vary from a minimum of 1 day (defined as midnight to midnight the following day) to a maximum of the entire length of the time series. This differs from the BASE approach where the optimization period is set at 1 day. Sensitivity of the EBASE method to different optimization periods is described below."*

Line 185: On line 546 it is stated that linear interpolation is used, that should be described here. Furthermore, the threshold discussion on line 547-551 should be mentioned here. Lastly, on line 550-551, a 12 hour threshold should be further discussed. Why 12- hours? Why not 6 considering anything longer than 6 and you would be missing half of a semidiurnal tidal cycle.

*Response: 12 hours was chosen as a default value to cover approximately half of a diurnal cycle. Users may want to consider smaller gaps if tidal cycles are having a large influence on the observed time series. Our default value was chosen under the assumption that tidal effects, although they may be present, are likely not the dominant signal in the data. If the latter is expected, detiding is strongly encouraged. We have added text to this effect.*

*Line 186: "All gaps are linearly interpolated to allow the model estimation to proceed continuously and any results for an optimization period with gaps larger than 12 hours are removed, eliminating the need to pre- and post-process the data when using EBASE. The user can vary the criteria for removing results (e.g., 6 hours as a more conservative criteria)."*

*Line 555: "More conservative gaps can be chosen if, for example, semidiurnal tidal signals operating at time scales less than 12 hours are expected to influence the results. However, detiding is strongly encouraged in these cases and the default gap size of 12 hours that describes the diurnal oxygen signal is likely appropriate after detiding."*

*Also note that data for an entire optimization period are removed if any gaps greater than the chosen gap size are present, providing an additional safety measure that the results are not based on inaccurately interpolated inputs.*

Line 188: With your improvements to the original BASE method, could EBASE be used to estimate metabolism in non-tidal, lotic ecosystems?

*Response: In theory, EBASE could be used in non-tidal, lotic systems, since the primary difference with BASE is the use of a wind- and temperature-based gas exchange parameterization appropriate for open-water systems [@Wanninkhof14]. However, additional comparisons are needed (e.g., Odum vs EBASE in a lake) and our thorough justification for the default prior distributions are based on the estuarine literature. This is still a valuable point and we have added text to line 519:*

*"Further, EBASE could be applied to other non-tidal, lotic systems, although additional comparisons with existing methods are needed and the default uninformed prior distributions should be chosen carefully given the justification herein based primarily on estuarine literature [e.g., @caffrey2004]."*

Line 248-252: How was the NERRS data accessed? Also be sure to cite the NERRS system-wide monitoring program, see link on NERRS data citation here - https://cdmo.baruch.sc.edu/data/citation.cfm

*Response: The NERRS data were accessed through the CDMO, citation was added.*

Line 267: Consider rephrasing – “…has a structure similar to, yet noisier than, that of light efficiency…”.

*Response: Rephrased.*

Line 270-271: Wouldn't one expect the opposite? During periods of high productivity, ingassing should occur given the relatively high(er) rates of primary production. Then during periods of low productivity (i.e., outside of the growing season) that outgassing would dominate as respiration of allochthonous material continues to occur while primarily production would be light limited (assuming the example dataset used is in a temperate environment).

*Response: Yes, this is correct and can even be seen in Figure 2, e.g., late September to early October shows P \> R with negative D (ingassing), then P \< R with positive D (outgassing). We have corrected this error in the text.*

Line 276-278: As pointed to earlier in the manuscript, it is unclear what is meant by the optimization period. Why are the results in Figure 3 averaged by the optimization period? Why not show the daily estimates? I liked seeing the fit of the EBASE estimates on the synthetic time series however, I would like to see the fit of a linear regression of the synthetic (observed) estimates vs. the EBASE (predicted) estimates.

*Response: Please see the response to line 181. In particular, our revision notes that only one value each for $a$, $R$, and $b$ is returned for each optimization period. The vertical lines for each point in Figure 3 are credible intervals showing uncertainty around each individual estimate. The statement in the caption that "the results are averaged at the time step of the model optimization period" is incorrect and removed. This really only applies to the synthetic results in Figure 5 to show a more clear comparison with the recovered values from EBASE.*

Line 313: This explanation of optimization needs to come much earlier in the text and be expanded upon.

*Response: Agreed, please see the response to line 181. This section was also slightly shortened in response to the changes on line 181.*

Line 324-327: I'm not sure if I follow correctly - are you seeking daily metabolic estimates? If so, are the 7 & 30 day optimizations using a forward looking moving window approach that advances by one-day (similar to a rolling average)?

*Response: The text was edited for clarity: "Results from optimization periods of 1, 7, and 30 days were compared to the synthetic one-year time series ($b$ was fixed for the sensitivity analysis) based on daily averages for both the synthetic and EBASE results. For the latter, parameters that are only returned as individual values for each optimization period ($a$, $R$, and $b$) were assigned as daily values for comparability of summary statistics where $n$ is the same across analyses."*

Line 473-477: It is stated that “Bayesian…methods have not been rigorously explored for estimating metabolic rates in estuaries” however, I point back to the two cited studies in the introduction (line 98) that did use Bayesian techniques to estimate estuarine metabolism. Consider rewording this sentence and/or expand on why those earlier studies are not considered rigorous.

*Response: Please see our response to your general comment above.  Although @tassone2019 does provide another useful example, we still feel that these methods have not been thoroughly explored in estuaries.*

Line 581: Maybe I missed it but how many MCMC simulations were used? How would a user change the number of MCMC simulations in the EBASE package? Can you provide a recommendation for the number of simulations to use or at least how many were used in this analysis?

*Response: This detail was omitted and we have now included it on line 199 with the description of the MCMC approach (default 10,000 simulations).*

Figures 3 & 5: These figures have a gray background while the rest are white. Please make the background color of the figures consistent across figures.

*Response: Figures 3 & 5 were changed to white background.*

Figure 7: Consider adding points to the lines in the left column plots. You may need to make the thickness of the lines smaller.

*Response: Points were added, line thickness reduced in the left column plots.*

### Reviewer 2

Beck et al. developed a new method for estimating metabolism in estuaries using continuous dissolved oxygen data. Metabolism is a key component of ecosystems, yet it is inherently difficult to estimate, especially in estuaries due to tidal currents. Their method is based on a stream Bayesian approach, and the authors expanded it by adjusting the time interval over which model parameters are estimated. The longer intervals allow for estimation over tidal cycles, which acts as noise in the time series, and allows for improved model estimation. The authors also compared their model to a more conventional approach (i.e., Odum model) and show the model’s improved estimation, specifically avoiding impossible results, such as negative production.

The model is written in the programming language R, making it widely available to the public. The online documentation and vignettes are clear and show the users key features and examples of the package. This is a nice bonus to go along with a well-written manuscript and expand the impact of the products.

I enjoyed reading the manuscript. It is technical where it needs to be, but also provides general context for the problem and the rationale for the technique. I was tripped up during a few of the sections, and I provide some suggestions that might improve the flow of the article. I’m also wondering if this model approach is only applicable to estuaries, or if it could be useful for other aquatic ecosystems? Overall, the authors did a great job. Nice work!

*Response: Thank you for providing thoughtful comments on our manuscript. Please see our responses below.*

#### General comments

Table of model parameters. There are several parameters, most are relatively simple (single letter), and they appear on figures. I think it would be valuable to have a table. This could include, name, acronym, units, and any other relevant information (source/equation/etc.). I can also see organizing this table by inputs and outputs (L146) to help future users identify their input data and expected outputs.

*Response: We have added a new table showing model inputs/outputs, parameter names, acronyms, and units.*

Is EBASE only applicable to estuaries? It seems that the main change from BASE is the inclusion of a wider temporal window to estimate model parameters and changes in the b parameterization. Can these modifications also improve upon metabolism estimates in other systems (lakes, streams, etc.)? While I see the goal of improving metabolism in estuaries, there may be wider applicability to rivers, lakes, ocean, or other coastal areas. If so, mentioning what kinds of systems (big lakes, deep lakes, big rivers, complex hydrodynamics, etc.?) would be most appropriate for the model and potential get improved estimates over other metabolism approaches. This may expand the impact of this paper.

*Response: Yes, it is possible with caveats. Please see our response to reviewer one on line 188. Specifically, additional comparisons are needed and the default uninformed priors based on estuarine literature must be reconsidered.*

Model parameter b.

I’m less familiar with this term, and the authors could do a little bit more to explain what it is. On L143, they say that it is “fairly well known for open for open-ocean conditions”, but they never actually define the term. Looking at Eq 2, it seems to relate to “gas transfer efficiency” given that it is a coefficient on the wind-speed/viscosity term. That being said, I’m also a little confused on how Eq 3 is integrated into the model framework. Eq. 3 seems to relate more closely with streams as water depth is included as a scaler for kw. So somehow the two models (one more typical for lentic systems, the other more typical for lotic systems) are integrated together. In theory this makes sense in an estuary as both wind and flow likely affect gas transfer.

*Response: Apologies for this confusion. Eq. 3 is not used in EBASE, rather it is discussed as the gas transfer used in BASE that is inappropriate for our application, justifying use of the gas exchange model in @Wanninkhof14. Line 166 was revised to make this more clear: "Based on this difference and the lack of availability of other possible drivers of the transfer velocity in coastal systems, Equation 3 is not used herein. Instead, the well-established wind- and temperature-based parameterization for gas exchange of @Wanninkhof14 was used for EBASE (Equation 2)..."*

Diving into eq 3, higher water levels usually indicate higher flows and thus higher gas transfer velocity (Kw). I’m not exactly sure how temperature plays into this equation, and if it is appropriate for an estuary. It seems to suggest warm periods within a day have higher exchange rates, due to differences in kinetics at the water surface. However warmer temperatures may also reflect increased stratification and less vertical mixing (small lakes). There may be something to clean from changes in temperature that drive changes in turbulence, but simply using warmer = more exchange seems like an oversimplification. Eq 3 also includes a term related to water depth (H). In flowing waters this equation suggests that Kw increases with water level, likely a result of high-water levels = higher velocities = higher turbulence = higher kw. In an estuary, I’m not sure this relationship truly holds as water depth is not as good of a surrogate for velocity. Highest water level may be at slack tide and thus minimal water movements. It could be that change in water depth (assuming the tidal currents are strong relative to the river inputs) would be a better term to reflect instantaneous discharge. Or possibly flow could be included as a possible input parameter. But I realize this term is not typically available.

*Response: We have noted lack of clarity in our description of Equation 3 that includes the depth-dependency.  As noted by Reviewer 3, @Grace15 do not include a depth-dependency in this equation. We have since revised the equation and text accordingly, emphasizing the importance of wind for the transfer velocity in open-water systems.  Regarding temperature, we feel justified in its inclusion for gas exchange given the previously noted relationship with the Schmidt number, a known factor to be important in open-water systems.  Also see our response to your comment on line 164.*

All told, perhaps the issue with poorly constraining b is related to assumptions in the equations used to model gas exchange in an estuary. The authors do a good job explaining that the model parameter b was difficult to constrain in the example dataset. This is understandable, and my comments are mainly my mental exploration of ways that might improve that aspect of the model. I’m guessing the authors have thought extensively about this problem, and I’m mainly offering ideas. Perhaps the authors could include some other ideas for why the b parameter is difficult to constrain? Or explore additional datasets to understand when/where it can be estimated more accurately? For example, if the model was applied to an artificial dataset from a stream, lake, or other type of estuary does it perform better? If so, what is different about the system, which might help with tuning the model? Would any of these help understand the parameterization/limitation of the current model, and or identify systems it is most appropriate?

*Response: Yes, we agree this issue is perplexing and worth exploring further.  We have mentioned in the original draft how this could be explored further, e.g., evaluation in other locations where gas exchange may be a more dominant component of the metabolic model (line 490).  We have also added a brief description of @appling2018 that confront this issue in stream metabolic models.  Please see our response to the general comments from Reviewer 3.*

#### Specific comments

L26: which open-source software? If only one (i.e., R), then can list it here.

*Response: Added R in parentheses.*

L40: Organic matter produced in the estuary has other outcomes. Re-respired, consumed and incorporated into biota, exported to the ocean, etc.

*Response: Sentence was revised as follows: "...forming particulate organic carbon with multiple fates, e.g., buried in estuarine sediments, incorporated into biota, transferred to the ocean, etc. [@hu2006; @middelburg2007]."*

L83: which computed rates were negative? P, R, or both?

*Response: Revised as "The computed rates were negative 23% of the time for both P and R..."*

L128: mean depth?

*Response: The software can handle a single value (e.g., mean depth) or a vector of tidal height depths equal in length to the input time series. This is expressed in the documentation: https://fawda123.github.io/EBASE/reference/ebase.html. This is also expressed in the new table showing model inputs/outputs as requested above.*

L133: Thanks for providing the units. I am curious about area and time. I’m assuming that area is surface water area and time is the interval of the dissolved oxygen data. If so, perhaps expand on these so the author knows what the temporal and horizontal spatial scales are.

*Response: Please see the new table for inputs/outputs. Although equation 1 can apply to different units of space and time, we have added those used herein in parentheses: "The equation has dimensions of moles per unit area and time (e.g., $\text{mmol}~\text{m}^{-2}~\text{d}^{-1}$)."*

L134: “R is constant”. I believe R is allowed to vary across days, but R is constant within a day. Please specify.

*Response: We have specified that the unknown metabolic parameters ($a$, $R$, and $b$) are constant at the unit of the model optimization period chosen by the user, although P and D vary continuously given their dependence on measured input parameters (e.g., PAR, wind) that can change at each time step. Please see our response to reviewer 1 on line 181.*

L143: what is b? and for what time interval is b constant? This ends up being an output (Figure 3) and it is confusing to say that it is constant. So maybe it is constant within a day? Is this a standard parameter for gas exchange? As with the other parameters, providing some type of ‘name’ would be helpful, especially if provided in a table.

*Response: Please see our response to the previous comment and the new input/output table. It's an ambiguous parameter, but really just an indication of how sensitive the gas transfer is to wind speed. The sentence was revised as "The $b$ parameter is fairly well known for open-ocean conditions primarily as an expression of the sensitivity of gas exchange to wind..."*

L164: The equation implies that Kw would increase as water level (H) increases. It seems the authors have this statement inversed or talking about measured reaeration (K). I believe this relates to streams where increasing water levels relate to higher water velocities, and thus higher turbulence and higher gas transfer velocity (kw). See General Comments.

*Response: This was an inaccurate statement on our part.  We have updated the equation and text accordingly:*

*Line 141: "Equation 1 is similar to the oxygen mass balance equation in BASE [@Grace15], with the main difference being the treatment of gas exchange. While both assume that gas exchange is proportional to the concentration gradient across the air–water interface, the treatments of the proportionality differ.  @Grace15 used the following for the volumetric gas flux ($Dvol$) in BASE:*

$$
Dvol = [\, -K \cdot 1.024^{\left(T - \bar{T} \right)}\left(C_{sat} - C \right) ]\,
$$

*where $T$ is the instantaneous water temperature, $\bar{T}$ is the average water temperature over each 24-hour period in the oxygen time series (both in $^{\circ}$C), $C$ is the measured dissolved oxygen, and $C_{sat}$ is the saturation concentration. $K$ is the reaeration coefficient, which was estimated from the data.  In EBASE, gas flux per unit surface area of the air-water interface is proportional to the concentration gradient, with the proportionality taken from the well-established wind- and temperature-based parameterization for gas exchange of @Wanninkhof14 (see Equation 2).  EBASE also allows $b$ to be a free parameter that may reflect spatial and temporal variability in factors other than wind and temperature that may influence transfer velocity. @Wanninkhof14 estimated a fixed $b$ parameter as 0.251 $\left(\text{cm}~\text{hr}^{-1}\right)/\left(\text{m}^2~\text{s}^{-2}\right)$."* 

L189: Thanks for putting together the web page. I’m curious if the data in this manuscript are included within the package itself, so it is possible to regenerate the results entirely? I’m also wondering how stable this website is and if any online information that is described in the manuscript will change? I’m not that familiar with these online reference materials, but I’m thinking of a static version (tag) that will stay with the paper so a reader 10 years from now could access the exact same materials that go along with this paper.

*Response: It's the exception and not the norm that published software remains the same after a descriptive manuscript is published. For this reason, we have added a version of EBASE that is appropriate for this paper (v1.0.0) and included the version number in the text. EBASE is also now on [CRAN](https://cran.r-project.org/web/packages/EBASE/index.html), the Centralized R Archive Network, where a majority of publicly available R packages are hosted, in addition to the [GitHub repository](https://github.com/fawda123/EBASE). We have also added text on line 193 indicating where source materials for this manuscript (i.e., to reproduce results) can be found: "All results provided herein were generated using the EBASE R package (specific materials for this manuscript can be found at <https://github.com/fawda123/ebase-manu>)."*

L210: Thank you for providing the units for these parameters. I am wondering if that authors considered using negative exponents to ensure the division symbols are properly addressed. For example, 300 mmol/m2/d. While I understand this to be mmol m-2 d-1, days could be mistakenly assumed to be in the numerator of the equation. While unlikely in this situation, the subsequent equations (L218) get even more complicated “(mmol/m2/d)/(W/m2)”, so it could be worth ensuring all the units are clear. Further, this unit has m2 twice, so they could be removed from the final unit (mmol d-1 W-1).

*Response: Point well taken, we have not been consistent in the exponent notation as the text uses positive with fractions and the figures use negative with no fractions. We have corrected all instances in the text to use negative exponents. However, we have retained the units for $a$ since this makes the relationship between $P$, $a$, and $PAR$ more clear, i.e., the units for PAR ($W~m^{-2}$) when multiplied by the units for $a$ ($\left(\text{mmol}~\text{m}^{-2}~\text{d}^{-1}\right)/\left(W~m^{-2}\right)$) produce the units for P ($\text{mmol}~\text{m}^{-2}~\text{d}^{-1}$).*

L237: The upper limit of 0.502 for b. This makes sense to constrain this parameter. I also noticed that many of the estimates of b are close to this value rather than near the synthetic value for the example dataset (Figure 3). I’m wondering if anything within the model could be improved to handle this issue? See general comments.

*Response: Yes, we noticed this behavior as well.  To us, this is a reflection of the instability in the parameter estimation.  Earlier iterations of model development did not have this constraint and the $b$ parameter was often estimated at unreasonably high values, often causing the other parameters ($a$ and $R$) to also be unreasonable. We previously described some rationale for why this parameters was so poorly constrained and offer some potential solutions for future research (i.e., lines 482-490, 502-509.)*

L272: I’m curious about the model estimates for kw. The authors show the results for flux (D), but this will vary with concentrations and k. Wondering if there is anything else to glean from those modelled results?

*Response: Perhaps, although our focus was on the primary metabolic parameters returned by EBASE given the goal of assessing parameter recovery (of which kw is included). For sake of interest, below is a plot of D and kw for the synthetic data (data available here: <https://raw.githubusercontent.com/fawda123/BASEmetab_script/master/data/apafwoxy2.csv>).  Note that kw is directly proportional to wind, whereas D is mostly a function of kw and the difference between C and Csat.*

```{r}
#| fig-width: 8
#| fig-height: 4

fwdat <- read_csv(file = url('https://raw.githubusercontent.com/fawda123/BASEmetab_script/master/data/apafwoxy2.csv'))

fwdatcmp <- fwdat %>% 
  mutate(
    DateTimeStamp = dmy_hms(datet, tz = 'America/Jamaica'),
    Date = as.Date(DateTimeStamp),
    D = -1 * `gasex,mmol/m2/d`,
    kw = `kw,m/s`
  ) %>% 
  select(Date, D, kw) %>% 
  pivot_longer(cols = c(D, kw), names_to = 'var', values_to = 'val') %>% 
  summarise(
    val = mean(val, na.rm = TRUE),
    .by = c('Date', 'var')
  ) %>% 
  mutate(
    var = factor(var, levels = c('D', 'kw'), labels = c('D (mmol m-2 d-1)', 'kw (m s-1)'))
  )

ggplot(fwdatcmp, aes(x = Date, y = val, color = var)) +
  geom_line() + 
  geom_point() + 
  theme_minimal() + 
  facet_wrap(~var, scales = 'free_y', ncol = 1, strip.position = 'left') +
  theme(
    strip.placement = 'outside', 
    legend.position = 'none'
  ) +
  labs(
    x = NULL,
    y = NULL
  )
```

L301: The units for R are listed as (mmol/m2/d)/(W/m2). Perhaps the denominator is a typo?

*Response: Yes, this was a typo, corrected.*

L541: Wondering if it would be helpful to mention somewhere in this paragraph, “it depends on the question/objective of the project”? For example, if we are interested in annual summations and comparisons among systems, it may be fine to use a longer optimization period. But if we are interested in daily rates, timing of events in relation to storms, floods, etc. we may need to use a shorter optimization period. So the researcher’s question should be considered.

*Response: Good suggestion, we have added this text to line 541 (also note the last sentence that was added in response to a general comment from reviewer 1 regarding how frequency of continuous sampling may affect the results): "These hypotheses may relate to the length of time over which potential factors affect metabolism, e.g., storm events may affect metabolism at short time scales and a shorter optimization period could be used, whereas longer optimization periods may be more desirable if interested in long-term, climate-related effects on metabolism. These hypotheses may also consider frequency of continuous monitoring (e.g., 15 minute vs hourly) and how this may influence the results, as this is currently unknown for EBASE."*

### Reviewer 3

Beck et al. present a new software package to estimate ecosystem metabolism from time series of dissolved oxygen and accompanying physical variables in estuarine systems. Accurately estimating metabolic rates are critical to understanding impacts on estuaries and their role in material cycling. The work is highly novel as no such statistical approach is currently available for estuaries. The software adapts a package built for estimating metabolism in stream ecosystems using a Bayesian framework, which is highly suited to this task due to the ability to place prior distributions on physical parameters with known physical limitations. I found the paper to be very clear and the choices made in model development, setting of priors, and model validation to be robust and well documented. The improvements made to the model, such as the option to vary the optimization period, are valuable and were demonstrated to be important to accurately estimating rates (and mirror suggestions for dealing with inaccurate K in streams; e.g. Appling et al. 2018 https://dx.doi.org/10.1002/2017JG004140)

In particular, the focus on the importance of accurately capturing the physical variables is a strength of the paper. It is made clear from the outcomes of the synthetic dataset analysis that it is better to use a literature estimate of the parameter b, a constant in the equation that governs air-water exchange, then to let the model estimate inaccurate values for b. The discussion around this issue was appropriate, but I wonder if some more very clear advice could be provided to a potential user that wants to use this package to answer questions about ecosystem metabolism in estuaries but does not have the aim of further refining the modelling approaches. Could they use the estimate from Wanninkhof (2014) as was used in subsequent analyses here? Would an appropriate sensitivity analysis be to vary this estimate by 20% (as mentioned L224) to check if their P and R results are highly sensitive to this parameter? Or is further testing in a range of estuaries required before this can be applied?

*Response: Thank you for these suggestions.  We agree an explicit description of how the approach can be applied regarding uncertainties in the $b$ parameter is needed.  Some discussion is already included (e.g., line 488).  We have also added text describing how @appling2018 addressed the issue, although this addition describes further model development rather than application.  Revisions were made to the first paragraph of the discussion.*

*Line 490: "For application, users of EBASE may simply use a fixed value for $b$ (e.g., 0.251 $\left(\text{cm}~\text{hr}^{-1}\right)/\left(\text{m}^2~\text{s}^{-2}\right)$) or perform a simple sensitivity analysis by varying $b$ +/- a small percentage to determine how $P$ and $R$ may change.  Further model development may consider alternative approaches for dealing with equifinality, i.e., when the same modeled DO time series can be returned with different estimates of $P$, $R$, and $D$.  @appling2018 provide a useful example for a stream metabolic model that addresses equifinality by allowing model parameters to vary with key drivers at sub-daily scales (e.g., gas exchange versus discharge) and avoiding assumptions that model residuals are uncorrelated."*

#### Specific comments:

L14: The first use of “unphysical” in the abstract was a little unclear without further detail. Consider a short phrase like “may lead to estimates that are physically impossible” be used to define this first.

*Response: Text was modified as suggested.*

L122: The sentence “We also attempt to constrain the gas transfer velocity using this approach but are unable, at least with the data sets used in this study.“ was unclear. Consider replacing “this approach” with a more precise statement (I assume “this approach” is the Bayesian framework, rather than a reference to the previous sentence on the test with the detided inputs?). I’m also not sure if “constrain” is the right word, as the issue was accurately estimating this parameter.

*Response: The sentence was modified to clarify the meaning. We have retained "constrain" given that it's used throughout the paper, but we provide an explicit meaning in parentheses: "We also attempt to constrain (i.e., accurately estimate) the gas transfer velocity using EBASE but are unable...".*

L159 & L514: The air-water exchange isn’t depth dependent in BASE. The inputs (and metabolic results) in base are all volumetric and reaeration coefficient (K) is in per day. Depth is not provided to the model but can be used to convert the metabolic estimates afterwards.

*Response: Thank you for pointing out this error.  We have removed this from the text and revised accordingly.  Please see our response to reviewer 2 for line 164.*

L258: typo in “estimatd”

*Response: Fixed.*

L269: Should it be “availability” rather than “variability”? of course, a more variable pool of organic matter could also be correct.

*Response: Changed to "availability", this seems more correct.*

L352: The “right answer for wrong reasons” is interesting. It could be clearer here that even though DO is estimated accurately, the P and R estimates will be inaccurate in this scenario.

*Response: Sentence was revised as follows: "...the potential for the model to produce the right answer (accurate $DO$) for the wrong reasons (inaccurate $P$, $R$, or $D$), since $DO$ is simply a mass balance of $P$, $R$, and $D$ (Equation 1). This issue, or equifinality, has been encountered in stream metabolic models [@appling2018]."*

## References
