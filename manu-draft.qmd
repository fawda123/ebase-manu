---
format: 
  docx:
    reference-doc: my_styles.docx
    number-sections: true
title: "EBASE manuscript"
bibliography: refs.bib
csl: limnology-and-oceanography.csl
author: 
  - Marcus W Beck:
      email: mbeck@tbep.org
      institute: [TBEP]
      correspondence: true
  - Jill M Arriola:
      email: jva5648@psu.edu 
      institute: [PSU]
      correspondence: false
  - Maria Hermann:
      email: mxh367@psu.edu
      institute: [PSU]
      correspondence: false
  - Raymond G Najjar:
      email: rgn1@psu.edu
      institute: [PSU]
      correspondence: false
 
institute:
  - TBEP: Tampa Bay Estuary Program, St. Petersburg, Florida 33701 USA
  - PSU: The Pennsylvania State University, University Park, Pennsylvania 16802 USA

filters: 
  - templates/scholarly-metadata.lua
  - templates/author-info-blocks.lua
  
execute: 
  echo: false
  warning: false
  ft.keepnext: false
  ft.align: left
---

```{r, results = 'hide'}
library(knitr)
library(here)
library(officer)
library(officedown)
library(flextable)

load(file = here('tabs/ebaseiotab.RData'))
load(file = here('tabs/apacmptab.RData'))
```

```{=tex}
\newcommand{\auni}{\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)}
\newcommand{\runi}{\text{mmol}/\text{m}^3/\text{d}}
\newcommand{\buni}{\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)}
```
## Abstract {.unnumbered}

*Key words*:

## Introduction

-   Overview of metabolism - importance
-   Existing methods: Odum/WtRegDO, BASE, references in @Grace15, applications to lakes and streams
-   Applications to estuaries - challenges
-   Goals and objectives

## Materials and Procedures

The Estuarine BAyesian Single station Estimation (EBASE) method provides a simple approach to quantify metabolic parameters from continuous dissolved oxygen time series. The EBASE mass balance equation is:

$$
H\frac{dC}{dt} = aPAR - r - \left[bU_{10}^2\left(\frac{Sc}{600} \right)^{-0.5} \left(C_{Sat} - C \right )\right]
$$ {#eq-ebase}

where the terms in the square brackets are production (P), respiration (R), and gas exchange (D), respectively, modeled as a function of the change in dissolved oxygen ($dC$) per unit time ($dt$) of the input data. Production is modeled linearly as a function of surface irradiance ($PAR$, Watts m$^{-2}$) and $a$ (light efficiency, $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$). Respiration is modeled with the single parameter $r$ ($\text{mmol}/\text{m}^3/\text{d}$). Gas exchange is modeled using the formulation in @Wanninkhof14 as a wind-based parameterization for the gas transfer velocity [@Ho16] multiplied by the oxygen concentration gradient as the difference between the concentration measured in the surface water layer, $C$ (mmol m$^{-3}$), and the saturation (or equilibrium) concentration, $C_{Sat}$ (mmol m$^{-3}$), calculated from salinity (psu) and temperature ($^\circ$C) [@Millero81; @Garcia92]. The gas transfer velocity is modeled using wind speed squared at 10 meters above the water ($U_{10}^2$, m$^2$ s$^{-2}$), water column depth ($H$ in meters, as a fixed parameter or time series from a pressure sensor), and the Schmidt number ($Sc$) defined as the ratio of the kinematic viscosity of water to the molecular diffusivity of the gas for oxygen [from water temperature and salinity using the polynomial fit in @Wanninkhof14]. The $b$ parameter is estimated from the data and has units of $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$. As such, the three parameters estimated by EBASE are $a$, $r$, and $b$ using the required input data that includes time series of dissolved oxygen, water temperature, salinity, PAR, wind speed, and water column depth (`r run_reference(id = "ebaseiotab")`).

The EBASE approach was based on several modifications to BAyesian Single-station Estimation (BASE) the mass balance equation described in @Grace15:

$$
\frac{dC}{dt} = aPAR^p - r\Theta^{T - \bar{T}} + \left[K\cdot1.0241^{T-\bar{T}}\left(C_{sat} - C \right )\right]
$$ {#eq-base}

where all parameters are defined as in @eq-ebase, with the additional parameters $p$, $\Theta$, and $K$ (the rearation coefficient). The BASE approach provides options to estimate $p$ and $\Theta$ from the data or to set as fixed values. A temperature dependency, $T$, is also included where respiration and gas exchange vary with temperature. The changes to @eq-base for EBASE were necessary for estuarine application and included 1) a linear relationship of production to PAR ($aPAR$) by setting $p = 1$; 2) constant respiration by removing the temperature dependency; and 3) use of a gas exchange parameterization commonly used in coastal or oceanic settings that depends on wind speed and temperature [i.e., @Grace15 used a littoral parameterization]. The justification for these changes is as follows.

### Changes to BASE

A common theory behind most gas exchange parameterizations for metabolism estimates is that the transfer of gases of relatively low solubility, like oxygen, is proportional to the concentration gradient in a thin film of water at the air--water interface. It is also assumed that the water at the top of the film is saturated with respect to the atmosphere, so that the concentration difference across the thin film can be approximated as the difference between oxygen concentration measured in the surface water layer, $C$, and the saturation (or equilibrium) concentration $C_{Sat}$, which is usually calculated as a function of water temperature and salinity (the negative sign is needed because positive flux is set to be from water to air):

$$
D = -k_w \left(C_{sat}-C \right).
$$ {#eq-gasex}

The gas transfer velocity, $k_w$, has dimensions of length over time and increases as the water column in the vicinity of the air--water interface becomes more turbulent. As such, $k_w$ is usually modeled as a function of measurable variables that can potentially predict turbulent mixing of the surface water, e.g., wind speed, current velocity, and water depth [@Ho16]. $k_w$ also increases with temperature because the film of water at the air-sea interface becomes more thin as the random motion of gas and water molecules increases at higher temperatures and transfer of molecules across the film increases. This dependence of $k_w$ on temperature is usually modeled with the Schmidt number as in @eq-ebase, which combines information on the viscosity of the fluid and the diffusivity of the gas.

@Grace15 used the following for the gas transfer in BASE:

$$
\frac{k_w}{H} = K \cdot 1.024^{\left(T - \bar{T}\right)}
$$ {#eq-gasexbase}

where $\bar{T}$ is the average water temperature over each 24-hour period in the oxygen time series and $K$ is the reaeration coefficient estimated from the data. @eq-gasexbase indicates that $k_w$ increases with temperature and depth. The temperature dependence is consistent with the known decrease of $k_w$ with the Schmidt number, but the depth dependence is difficult to justify. An expectation is that $k_w$ would increase as water depth decreases for a given current speed because turbulence generated at the sediment--water interface by currents would more easily reach the surface [@Ho16]. Based on these differences, the wind-based parameterization for gas exchange was used for EBASE [@Wanninkhof14]. Additionally, $C_{sat}$ was calculated using only temperature and salinity, removing the need for barometric pressure used in BASE.

The additional modifications to @eq-base for EBASE were removing the $p$ and $\Theta$ parameters from the production (P) and respiration (R) components, respectively. The BASE method provides options to estimate both $\Theta$ and $p$ from the data or to set as fixed values defined in the model file ($\Theta = 1.07177$, $p=1$). For EBASE, the temperature dependency of respiration is removed by setting $\Theta^{(T-\bar{T})}$ = 1 and it is assumed that respiration is constant as in other methods [@Odum56; @Murrell18]. The $p$ parameter, which is dimensionless, is also set to 1 as in @Holtgrieve10, such that a linear relationship of production to $PAR$ was used. This removes the exponential dependence of production with increasing $PAR$. Removing these components also improved model stability by creating more reasonable estimates for the other parameters.

### EBASE model estimation {#sec-ebasemod}

The remaining three parameters $a$ (light efficiency, $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$), $r$ (respiration, $\text{mmol}/\text{m}^3/\text{d}$), and $b$ ($\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$) are estimated by likelihood given the observed data and prior distributions for the parameters. The JAGS software [as for BASE, @Plummer03] is used with the EBASE R package [described below, @Beck22; @RCT22] to estimate the unknown parameters using Markov Chain Monte Carlo simulations in a Bayesian framework. At each time step, the change in oxygen concentration between time steps is calculated from the equation using model inputs and parameter guesses based on the prior distributions, and then a finite difference approximation is used to estimate modeled oxygen concentration. Estimations proceed using a forward in time integration where the dissolved oxygen at each time step is informed by parameter estimates from the preceding time steps. The estimated dissolved oxygen concentration is also returned, which can be compared to the observed values as one measure of model performance. All parameter inputs and outputs for EBASE are shown in `r run_reference(id = "ebaseiotab")`. Areal rates for $P$, $R$, and $D$ (mmol m$^-2$ d$^{-1}$) are returned for comparability of estimates across locations where water column depth may vary.

The metabolism estimates and their parameters returned by the Bayesian routine implemented in JAGS are affected by the prior distributions assigned to each. As for the BASE model, relatively uninformed prior distributions following a normal Gaussian distribution are used by default, although the priors can be changed based on previous knowledge of parameters specific to an ecosystem or as informed by other metabolic modeling approaches. Reasonable uninformed prior distributions for EBASE were chosen with mean values using approximate estimates from the literature [@Wanninkhof14;@Grace15] and standard deviations that were sufficiently large to allow the Bayesian routine to search an unconstrained parameter space.  The default priors for $a$, $r$, and $b$ are:

$$
a \sim N(0.2, 1)T(0,\infty) \;\; \left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)
$$ {#eq-aprior}

$$
r \sim N(20, 50)T(0,\infty) \;\; \text{mmol}/\text{m}^3/\text{d}
$$ {#eq-rprior}

$$
b \sim N(0.251, 0.1)T(0,0.502) \;\; \left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)
$$ {#eq-bprior}

where $N(\alpha, \beta)$ indicates a normal distribution with mean $\alpha$ and standard deviation $\beta$ and $T(\gamma, \delta)$ is 1 between $\gamma$ and $\theta$ and 0 elsewhere; $T$ has the effect of truncating the normal distribution to minimum and maximum values. All prior distributions were constrained to positive values based on known physical constraints and requirements of the model formula in @eq-ebase. Additionally, the prior distribution for $b$ was constrained to an upper limit of 0.502 (\~twice the default mean). Initial development of EBASE showed that using an undefined upper limit of $b$ led to unstable and unreasonable parameter estimates.  Examples of the prior distributions in Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior] are shown in @fig-priorplot.

For ease of application, an R package was developed to implement the EBASE methods described above [@Beck22]. A detailed web page (<https://fawda123.github.io/EBASE/>) describes the required data inputs for estimating the metabolic parameters using the core R functions that pass inputs to the JAGS software. A JAGS model file is included with the package that implements @eq-ebase, with options to supply a custom model file as needed. Users can also specify alternative prior distributions from those in Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior] for each parameter. Functions are available for viewing model results, including a plot of the modeled dissolved oxygen with the observed, a time series plot of the primary metabolic estimates (P, R, and D, as areal rates with units $\text{mmol}/\text{m}^3/\text{d}$), and a time series plot of the credible intervals for the $a$, $r$, and $b$ parameters. An additional option allows the user to specify the model optimization period, where the time period can vary from a minimum of one day to the maximum of the entire length of the time series. This differs from the BASE approach where the optimization period is set at one day. Sensitivity of the EBASE method to different optimization periods is described in @sec-cmpmod. All results provided herein were generated using the EBASE R package.

## Assessment

### EBASE comparison with known results {#sec-cmpmod}

A preliminary assessment of the ability of EBASE to produce reasonable parameter estimates for $a$, $r$, and $b$ (@eq-ebase) was conducted using a synthetic time series with actual data as inputs. These assessments evaluated if 1) EBASE estimates similar values for the known parameters in the synthetic time series, and 2) how the estimated values change with different model configurations. The synthetic time series used inputs from one year of continuous data from Apalachicola Bay, Florida. The input data were 2012 observations at the Cat Point water quality monitoring station (29.7021$^{\circ}$ N, --84.8802$^{\circ}$ W) and included 15 minute observations of water temperature and salinity. Continuous meteorological observations from the nearby East Bay station (29.7909$^{\circ}$ N, --84.8834$^{\circ}$ W, \~10km north of Cat Point) were combined with the water quality data at the same time step and included air temperature, wind speed, and PAR. Missing observations in the water quality and meteorological data were filled using autoregressive modelling of the actual parameters versus time to create a complete dataset from January 1st to December 31st. A synthetic oxygen time series was then generated using the inputs from Apalachicola Bay ([@fig-synapa]a) and @eq-ebase as a forward calculating model with user-defined values for $a$, $r$, and $b$.  All metabolic rates for production, respiration, and gas exchange ([@fig-synapa]b and c) were also estimated with the synthetic time series. The only parameter that could not be created as a continuous time series was $b$, which was set to 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ [@Wanninkhof14].  Accordingly, the synthetic dissolved oxygen time series and the observed water quality and meteorological data were used with EBASE to determine if reasonable estimates for the known parameters and metabolic rates were recovered.

Several configurations of the EBASE model can influence how the parameters and metabolic rates are estimated. Two types of sensitivity analyses were conducted to evaluate changes in the results returned by EBASE, where in all cases, the results were compared to the known values in the synthetic time series. First, results were compared to the known values after changing characteristics of their prior distributions. Second, results were compared using a model period of optimization for one, seven, and 30 days to assess how results varied based on the amount of data used for the Bayesian estimation. Details of these analyses are as follows.

The prior distributions for the EBASE parameters follow truncated normal distributions with defined means and standard deviations (Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior]). The sensitivity analysis evaluated changes in the distributions by varying the means and standard deviations from small to large to test the effect of changes in the central tendencies and more or less constrained ranges, respectively, on the priors. For each parameter, low and high values for the means and standard deviations were assessed as changes approximately equal to two orders of magnitude of the means and standard deviations of the known parameters of the synthetic time series. The only exception was the $b$ parameter where the low values created priors with a distribution close to zero and the high values were equivalent to a uniform prior distribution in the range of 0 to 0.504 (justification noted in @sec-ebasemod). Each unique combination of low and high values for the means and standard deviations of each parameter were evaluated, creating 2$^6$ = 64 different combinations of prior distributions that were used with the synthetic time series in EBASE.

The optimization period used for a time series determines how much data are used to estimate the three EBASE parameters ($a$, $r$, and $b$). Unlike BASE, the EBASE software allows flexibility in the period of time used for optimization, with a minimum being one day and a maximum being the length of the time series. For a chosen optimization period, single estimates for $a$, $r$ and $b$ are returned by the model. A short period of optimization (e.g., one day) may return unstable parameter estimates if forcing factors (e.g., wind, temperature) that affect estuarine biogeochemical rates occur at time scales longer the chosen period of optimization for EBASE. As such, potentially longer optimization periods may return more stable and robust estimates given that more data are used for parameter estimation, although at the risk of overgeneralizing metabolic rates if variation occurs at time scales less than the optimization period. Results from optimization periods of one, seven, and thirty days were compared for the synthetic one-year time series. Each optimization period was also evaluated for every unique combination of prior distributions, totaling 192 (64 times the three optimization periods) unique analyses for the assessment of changing priors of all parameters.

Changing the prior distributions affected the ability of EBASE to return the known parameters from the synthetic time series, with results varying by optimization period. @fig-priorcomp shows a summary of the comparisons of the synthetic data with EBASE for each unique combination of prior distributions and the three optimization periods of one, seven, and thirty days. The results are shown using Nash-Sutcliffe Efficiency (NSE) values [@Nash70;@Moriasi07]: 

$$
NSE = 1 - \frac{\sum\limits_{i=1}^n \left(Y_i^{Syn} - Y_i^{EBASE}\right)^2}{\sum\limits_{i=1}^n \left(Y_i^{Syn} - \bar{Y}^{Syn}\right)^2}
$$ {#eq-nse}

where $Y_i$ is the estimate from EBASE or the synthetic times series for the optimization period $i$, evaluated for each metabolic parameter, each unique combination of priors, and each optimization period. The value $n$ is the number of optimization periods in the one-year time series, i.e., $n=365$ for one day, $n \approx 52$ for seven days, and $n \approx 12$ for 30 days. All metabolic estimates were averaged within the number of days for each optimization period prior to calculating NSE values, if appropriate. The NSE value is conceptually similar to the coefficient of determination, but varies from $-\infty$ to 1.  Values in the positive range from 0 to 1 are desirable with 1 being a perfect fit, whereas values in the negative range indicate the mean of the synthetic data is a better predictor than EBASE. 

<!-- edit -->

Several conclusions can be made from the results in @fig-priorcomp based on the patterns of the NSE values. Overall, the model was able to estimate the $a$ parameter with reasonable precision regardless of any of the prior distributions, whereas most of the variation was observed in the $r$ (respiration, R) and $b$ parameters. Changing the variance of the $a$ parameter had little effect on any of the comparisons. Smaller variance of the prior distribution for the $r$ parameter generally contributed to lower $R^2$ for all parameters, although the precision was worse for the seven day optimization period (e.g., the $a$ parameter). Conversely, larger variance of the prior distribution for the $b$ parameter generally contributed to lower $R^2$ only for the gas exchange estimate (D), although this effect was minimized with the seven day optimization period.

The results suggest that the default prior distributions used in EBASE may be appropriate in some cases, but increasing the prior variance for $a$ and $r$ and decreasing the variance for $b$ will likely produce more optimal solutions. The actual model results for the best performing combination of prior distributions for the one day and seven day optimization are shown in @fig-optex (all results are averaged at the time-step of the optimization period for comparability). The best performing models were those with the highest mean $R^2$ values across all parameter estimates in @fig-priorcomp. For both models, the metabolic parameters were estimated with high precision, and in some cases with nearly perfect precision (i.e., dissolved oxygen and gas exchange, D). Estimates for the fixed $b$ parameter were most variable, but not biased as the mean for both models was close to 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$.

<!-- edit -->
### EBASE comparison with real observations

Metabolic estimates from EBASE were further compared to those from existing methods to benchmark and evaluate potential differences from alternative model formulations used by each approach. The observed one year continuous time series described above for water quality and weather data from Apalachicola Bay was used to compare metabolic estimates from EBASE, BASE, and the Odum open-water method [@Odum56]. The Odum method used an approach described in @Murrell18 created for estuarine application that uses a gas-exchange approach described in @Thebault08. For better comparison with the EBASE methods, the gas exchange parmaterization in the Odum method was modified to use the @Wanninkhof14 approach [as available in the WtRegDO R package, @Beck21]. The input data were provided to each method after converting the units as required (e.g., BASE requires PAR as $\mu$mol/m$^{2}$/s). Water column depth at Cat Point is approximately 1.8 m and all daily metabolic estimates returned by each method were converted to volumetric rates by dividing by the depth (i.e., $\text{mmol}/\text{m}^3/\text{d}$). Each comparison also evaluated metabolic estimates using the observed dissolved oxygen time series and a detided time series using weighted regression [@Beck15; available from @Beck21]. The latter comparison provided an assessment of metabolic rates that are expected to be minimally influenced by tidal advection. All metabolic estimates were obtained using the default settings for each of the three methods, with an exception that the prior distribution for the reaeration coefficient ($K$) in BASE was informed by results from the Odum output. Initial assessments indicated that unstable and inaccurate results for the time series are obtained from BASE using an uninformed prior distribution for $K$. All other prior distributions for BASE and EBASE were set as the software default. A one day model optimization period was used for EBASE for comparability with BASE.

The common set of metabolic parameters returned by the Odum, BASE, and EBASE methods are net ecosystem metabolism, gross production, respiration, and gas exchange. Pairwise comparisons of the daily estimates returned by each method were evaluated using simple summary statistics, including Pearson correlation coefficients and linear regression fits to evaluate potential biases in each method. For the latter analysis, differences in intercept estimates less than or greater than zero suggested a bias in magnitude, whereas differences in slope estimates less than or greater than one suggested a bias that depended on relative value of each observation (e.g., bias may differ between lower or higher values). Comparisons of the intercept and slope estimates to zero and one, respectively, were based on confidence intervals from the standard errors of each. Results were assessed separately for estimates based on the observed or detided dissolved oxygen time series.

@fig-apacmpfig and `r run_reference(id = "apacmptab")` provide a comparison of the EBASE metabolic estimates with those from the Odum and BASE methods. Correlations for all estimates, regardless of method or the input time series, were positive and significantly correlated, as expected. The only exception was the comparison of respiration for the Odum and EBASE methods ($\rho$ = 0.11), where the former produced a much larger range of estimates. The intercept values were all significant, suggesting some level of bias when comparing estimates between the methods. Slope estimates were all significantly different from one for the comparisons using the observed dissolved oxygen time series as input, whereas only three of the eight comparisons were significantly different using the detided time series. This latter comparison suggests that detiding the time series produces more comparable estimates between methods. Similarly, the standard deviation ($\rho$) of the residuals of each regression comparison were generally lower in the detided results for all comparisons. Variation in the gas exchange estimates were also more similar comparing the Odum and EBASE methods that used the same formulation [@Wanninkhof14] regardless of input time series.

As noted in the previous paragraph, metabolic estimates between the methods were more similar for results using the detided dissolved oxygen time series ([@fig-apacmpfig]b) as compared to using the observed dissolved oxygen as input ([@fig-apacmpfig]a). This suggests that tidal effects on continuous monitoring data can severely violate assumptions required for methods of estimating ecosystem metabolism [as described in detail in @Beck15]. These effects are easily identified with estimates from the Odum method as negative values for production (P) and positive values for respiration (R), i.e., "anomalous" values. The effects of tidal advection on estimates from EBASE and BASE are more subtle as anomalous values cannot be returned based on constraints in the mass-balance equations (e.g., it is impossible for respiration to be positive). However, the effects of tidal advection produced a wider range of estimates for NEM in EBASE and BASE compared to the Odum method ([@fig-apacmpfig]a), caused by greater variation in the production and respiration estimates. Overall, detiding the dissolved oxygen time series prior to estimating metabolic rates produces more stable (lower standard deviation) and smaller ranges (`r run_reference(id = "apacmptab")`), regardless of the method used.

## Discussion

-   Describe how EBASE deals with gaps and flexibility of the model to accommodate diff optimization periods
-   b is sketchy, how to improve? Either fix or develop JAGS model further to include additional data, e.g. tidal height.

## Comments and Recommendations

## Acknowledgments {.unnumbered}

{{< pagebreak >}}

## Figures {.unnumbered}

![The default prior distributions for the $a$, $r$, and $b$ parameters used in EBASE. All priors are normal distributions and truncated to positive values. The $b$ parameter is also truncated to a maximum of 0.504.](figs/priorplot.png){#fig-priorplot fig-align="center"}

{{< pagebreak >}}

![Synthetic time series for one year of continuous data at Apalachicola Bay. Synthetic input to EBASE was the (a) dissolved oxygen time series, with results compared to the (b) synthetic $a$ parameter and (c) synthetic metabolic estimates for production (P), respiration (R), and gas exchange (D). The $a$ parameter is shown as an areal value for comparison with the metabolic results.](figs/synapa.png){#fig-synapa}

{{< pagebreak >}}

![Comparison of EBASE results to a synthetic time series created with known metabolic parameters. Results are compared for unique combination of prior distributions, where the means and standard deviations are evaluated from low (L) to high (H) for a one day, seven day, and thirty day model optimization period. The metabolic results for dissolved oxygen (DO), production (P), respiration (R), gas exchange (D), and the $a$ parameter are evaluated based on Nash-Sutcliffe Efficiency (NSE) values between the EBASE results and synthetic values. NSE values from zero to one (green) indicate EBASE has recovered the synthetic parameters with values closer to 1 being a better approximation, whereas negative values indicate the mean of the synthetic data is a better predictor than EBASE.  The color scale for NSE is also exponentially transformed to minimize the influence of large negative values on the visual display. The $b$ parameter is a fixed constant and was not evaluated.  Rankings of each combination as the median NSE value across all parameters in a row are shown on the right, with the top three as black/bold and bottom three as black/italic.](figs/priorcomp.png){#fig-priorcomp}

{{< pagebreak >}}

![Summaries of median Nash-Sutcliffe Efficiency values across all parameters for the comparisons of EBASE and synthetic model outputs separated by different combinations of prior values. Each result on the x-axis represents the median values for which the combination prior applies, e.g., all results from @fig-priorcomp where $\mu$ is high or low for the $a$ parameter using a one day optimization period.  Point size represents the inter-quartile range of median NSE values for each result.](figs/priorsumcomp.png){#fig-priorsumcomp}

{{< pagebreak >}}

![Comparison of EBASE results for the best and worst performing models to a synthetic time series created with known metabolic parameters. The best and worst performing models for the one day (a, b), seven day (c, d), and thirty day (e, f) optimization periods are based on the EBASE results with prior distributions that produced the highest and lowest median Nash-Sutcliffe Efficenciy values across all parameter estimates (@fig-priorcomp).  The results are averaged at the time step of the model optimization period. The $b$ parameter is fixed at 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$.](figs/optex.png){#fig-optex fig-align="center"}

{{< pagebreak >}}

![Comparisons of daily metabolic estimates from the Odum, BASE, and EBASE methods for one year of continuous monitoring data at Apalachicola Bay. Results for net ecosystem metabolism (NEM), gross production (P), respiration (R), and gas exchange (D) are compared using the (a) observed and (b) detided dissolved oxygen time series as input to each model. All values are volumetric as mmol O$_2$ m$^3$ d$^{-1}$. Black lines show the 1:1 comparison and the red lines show the linear regression fit.](figs/apacmpfig.png){#fig-apacmpfig fig-align="center"}

{{< pagebreak >}}

<!-- {{< pagebreak >}} -->

## Tables {.unnumbered}

```{r}
#| label: ebaseiotab
#| tbl-cap: "EBASE model parameters showing the required input, parameters derived from the model input, and model output.  The model notation for production, respiration, and gas exchange shows both the simple parameter name and the full model component used to estimate the parameter."
ebaseiotab
```

{{< pagebreak >}}

```{r}
#| label: apacmptab
#| tbl-cap: "Summary statisics of daily metabolic estimates comparing Odum and BASE to EBASE for net ecosystem metabolism (NEM), gross production (P), respiration (R), and gas exchange (D).  Separate comparisons are made for estimates based on observed and detided dissolved oxygen.  Summary statistics include Pearson correlation coefficients and intercept, slope, and residual standard deviation of a linear fit between the same metabolic estimates obtained from each method. Significance of the p-values for the intercept and slope indicates if the estimate is different from zero or one, respectively."
apacmptab
```

<!-- {{< pagebreak >}} -->

## References {.unnumbered}
