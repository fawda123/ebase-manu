---
format: 
  docx:
    reference-doc: my_styles.docx
    number-sections: true
title: "Fitting metabolic models to dissolved oxygen data: The Estuarine BAyesian Single-station Estimation method"
bibliography: refs.bib
csl: limnology-and-oceanography.csl
author: 
  - Marcus W Beck:
      email: mbeck@tbep.org
      institute: [TBEP]
      correspondence: true
  - Jill M Arriola:
      email: jva5648@psu.edu 
      institute: [PSU]
      correspondence: false
  - Maria Hermann:
      email: mxh367@psu.edu
      institute: [PSU]
      correspondence: false
  - Raymond G Najjar:
      email: rgn1@psu.edu
      institute: [PSU]
      correspondence: false
 
institute:
  - TBEP: Tampa Bay Estuary Program, St. Petersburg, Florida 33701 USA
  - PSU: The Pennsylvania State University, University Park, Pennsylvania 16802 USA

filters: 
  - templates/scholarly-metadata.lua
  - templates/author-info-blocks.lua
  
execute: 
  echo: false
  warning: false
  ft.keepnext: false
  ft.align: left
---

```{r, results = 'hide'}
library(knitr)
library(here)
library(officer)
library(officedown)
library(flextable)
library(dplyr)

source(here('R/funcs.R'))

load(file = here('tabs/ebaseiotab.RData'))
load(file = here('tabs/apacmptab.RData'))
load(file = here('data/apasumdat.RData'))
load(file = here('data/misdat.RData'))
```

```{=tex}
\newcommand{\auni}{\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)}
\newcommand{\runi}{\text{mmol}/\text{m}^2/\text{d}}
\newcommand{\buni}{\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)}
```
## Abstract {.unnumbered}

Continuous monitoring data for dissolved oxygen have been used to estimate the contribution of gross primary production and ecosystem respiration to net ecosystem metabolism. Most models for estimating metabolic processes make several assumptions on how biological and physical factors affect the expression of metabolism in dissolved oxygen data, which can lead to poorly constrained errors that influence the interpretation of results. In estuaries, these methods can inform our understanding of spatial and temporal patterns in trophic state, yet very few models have been developed that address challenges of estimating metabolism in these dynamic systems. This paper describes the development, assessment, and interpretation of results from a new approach for estimating metabolic rates in estuaries, the Estuarine BAyesian Single-station Estimation (EBASE) method. EBASE provides several advantages over existing models by using an integration formula appropriate for estuarine systems and using a Bayesian framework where critical model parameters are fit as a function of the data as informed by a set of prior distributions. This approach can also vary the time period over which critical model parameters are estimated. We demonstrate that EBASE can reproduce known metabolic parameters from a synthetic time series created with continuous monitoring data from the Apalachicola estuarine reserve and provide a quantitative assessment of how the prior distributions affect the model results. The approach is also bench-marked with more conventional methods for estimating metabolism, with critical differences attributed to formulation of the metabolic mass-balance equations and the underlying statistical framework (i.e., Bayesian vs simple integration). The EBASE approach is available using open source software and can be readily applied to multiple years of long-term monitoring data that are available in many estuaries. Overall, EBASE provides an accessible method to parameterize a simple metabolic model appropriate for estuarine systems and will provide additional understanding of processes that influence ecosystem status and condition.

*Key words*: Bayesian, dissolved oxygen, ecosystem metabolism, estuary, gas exchange, open source

## Introduction

Estuaries play a key role in the global cycling of elements because of high rates of biogeochemical activity at the interface between land, ocean, and atmosphere. As materials are transported from land to ocean, estuaries profoundly transform or filter these materials through various processes, chief among which are primary production and respiration, collectively referred to as metabolism [@schubel1984]. For example, estuarine respiration of organic carbon delivered from land produces carbon dioxide, which may be lost to the atmosphere via outgassing [e.g, @cai2011]. Similarly, estuarine primary production consumes dissolved inorganic carbon delivered from land, forming particulate organic carbon that may be buried in estuarine sediments [e.g., @hu2006]. Estuarine metabolic processes are fundamentally important, as illustrated by the dissolved inorganic carbon budget of eastern North American estuaries [@najjar2018]: net primary production (11.7 $\pm$ 3.0 Tg C yr$^{-1}$, best estimate $\pm$ 2 standard errors) and heterotrophic respiration (13.2 $\pm$ 3.1 Tg C yr$^{–1}$) far exceed inputs from upland sources (5.6 $\pm$ 1.2 Tg C yr$^{-1}$) and outputs to the atmosphere (4.2 $\pm$ 1.7 Tg C yr$^{–1}$) and ocean (2.9 $\pm$ 2.3 Tg C yr$^{–1}$). As such, small changes in either net primary production or heterotrophic respiration can have a large impact on the difference between the two, net ecosystem metabolism (NEM, sometimes also referred to as net ecosystem production), which ultimately governs the form and quantity of estuarine materials that are lost to the atmosphere, the sediments, and the ocean.

Methods for estimating metabolism in aquatic environments are numerous and include open-water techniques, bottle-based incubations, ecosystem budgets, oxygen isotopes, and use of inert gases [@kemp2011; @staehr2011]. Based on the variety of assumptions and limitations of each method, comparisons of metabolic rates within and between ecosystems have been challenging. For example, an assessment in Randers Fjord (Denmark) showed agreement in both the sign and magnitude among four different approaches [@gazeau2005]. However, gross primary production (P) and ecosystem respiration (R) estimates from incubations were consistently lower than those from open-water methods, consistent with the estuarine respiration synthesis of @hopkinson2005. Even within one technique, there are numerous choices to be made that alter the outcome. For example, in the commonly used ${}^{14}$C technique for measuring primary production, @cloern2014 noted that investigators have made divergent choices with regard to filtering mesozooplankton grazers, measuring ${}^{14}$C in dissolved organic carbon, accounting for changing spectral light quality with depth, and choosing the euphotic zone depth, the incubation time, and the incubation location (*in situ* vs. on-deck). These challenges are further compounded in estuaries where high temporal and spatial variability have been noted in global syntheses of P and R. @cloern2014 found that annual phytoplankton primary production can vary 10-fold within an estuary and up to 5-fold from year-to-year. @hopkinson2005 focused on cross-system variations and found benthic and pelagic respiration rates varying by more than factors of 30 and 40, respectively, ranges that are broadly consistent with whole system respiration rates based on the open-water method [@hoellein2013].

Advances in sensor technology for continuous collection of dissolved oxygen time series suggest that the open-water method [@Odum56] could be leveraged for applications across multiple locations. This approach exploits the diel cycle of dissolved oxygen and allows the simultaneous determination of whole-system gross primary production (net primary production $+$ autotrophic respiration), ecosystem respiration (heterotrophic $+$ autotrophic respiration), and NEM (P $-$ R). A global synthesis of warm-season, open-water metabolism studies [@hoellein2013] was based on a total of 47 estimates, almost all of which were derived from a single study of U.S. estuaries [@caffrey2004]. A similar synthesis was done by @yvon-durocher2012. These studies evaluated the open-water method as applied to continuous monitoring data available for several decades across the National Estuarine Research Reserve System (NERRS). Thus, the approach can be broadly applied where data are available, although it is not without limitations. In particular, tidal advection can violate assumptions of the method that the measurements are from the same parcel of water with a continuous metabolic history [@kemp1980]. Striking evidence of this challenge is the large number of physically impossible negative P and R estimates in the open-water analysis of 28 3-year time series by @caffrey2003. The computed rates were negative 23% of the time, on average, and as high as 69% for individual sites. Estimating gas exchange using the open-water method in estuaries has also been challenging. Most approaches estimate gas exchange using empirical formula dependent on wind speed and temperature or held at a constant value [e.g., @caffrey2004; @russell2007; @nagel2009; @Beck15; @Murrell18]. Gas exchange is a first-order process in the estuarine dissolved oxygen budget and, therefore, inaccurate estimations based on empirical formulae or fixed values can lead to poorly constrained errors that influence interpretation of results.

A unified model to explain the large variability of metabolic rates within and across estuaries is clearly lacking as a critical tool for understanding metabolic processes. Bayesian techniques have not been fully explored in estuarine applications despite their potential to address the above [although see @ciavatta2008]. Bayesian techniques allow for incorporation of prior knowledge about model parameters and robust estimation of parameter probability distributions [@Holtgrieve10] using highly efficient computational algorithms [@Grace15; @winslow2016]. These techniques are very powerful because they not only estimate P and R as standard open-water methods do, but they retrieve estimates and their uncertainties of parameters related to gas exchange, P, and R (e.g., the initial slope of the photosynthesis--irradiance curve), which reveals quantitative information about the mechanisms of metabolism and gas exchange. A potentially useful application developed for streams is the BAyesian Single-station Estimation (BASE) method [@Grace15]. BASE has been demonstrated to accurately determine metabolic parameters and their uncertainty using continuous monitoring data that are similar to those available at many estuarine locations. As such, modification of BASE to include model characterizations more appropriate for estuaries, while maintaining the fundamental Bayesian approach, could prove useful.

The goal of this paper is to describe the development and application of a new Bayesian method for simultaneously determining gross primary production, ecosystem respiration, net ecosystem metabolism, and the gas exchange (D) in estuaries from high-resolution dissolved oxygen time series. We call this method EBASE (Estuarine BAyesian Single-station Estimation), which builds and improves on the BASE method [@Grace15] using an approach more appropriate for estuarine time series. The rationale and changes made to BASE are described in detail, followed by a demonstration of how EBASE can estimate known metabolic parameters with reasonable certainty from a synthetic time series. Lastly, EBASE is compared to metabolic estimates using the Odum open-water method to identify key differences related to both the theoretical and statistical differences associated with each method. These comparisons combine results using real observations and those based on detided inputs to demonstrate effects of tidal advection on metabolic estimates. EBASE is available as an open-source software package created with the R statistical programming language [@Beck23; @RCT23] and the results herein provide practical suggestions for use of the software on novel datasets.

## Materials and Procedures

The Estuarine BAyesian Single station Estimation (EBASE) method provides a simple approach to quantify metabolic parameters from continuous dissolved oxygen time series. The EBASE mass balance equation is:

$$
H\frac{dC}{dt} = aPAR - R - k_w\left(C_{Sat} - C \right )
$$ {#eq-ebase}

The parameter $k_w$ is the gas transfer velocity defined as:

$$
k_w = bU_{10}^2\left(\frac{Sc}{600} \right)^{-0.5}
$$ {#eq-kw}

For @eq-ebase, the terms on the right side of the equation are gross primary production ($P$, $aPAR$), ecosystem respiration ($R$), and gas exchange ($D$, remainder), respectively, processes that result in the change in dissolved oxygen ($dC$) per unit time ($dt$); $H$ is the water depth. Production is modeled linearly as a function of surface irradiance (PAR, $\text{W}/\text{m}^2$) and $a$ (light efficiency, $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$). Respiration is modeled with the single parameter $R$ ($\text{mmol}/\text{m}^2/\text{d}$). Gas exchange is modeled using the formulation in @Wanninkhof14 as a wind-based parameterization for the gas transfer velocity [@Ho16] multiplied by the oxygen concentration gradient as the difference between the concentration measured in the surface water layer, $C$ ($\text{mmol}/\text{m}^3$) , and the saturation (or equilibrium) concentration, $C_{Sat}$ ($\text{mmol}/\text{m}^3$) calculated from salinity (psu) and temperature ($^\circ$C) [@Millero81; @Garcia92]. The gas transfer velocity, $k_w$ in @eq-kw, is modeled using wind speed squared at 10 meters above the water ($U_{10}^2$, $\text{m}^2/\text{s}^2$) and the Schmidt number ($Sc$), which is the ratio of the kinematic viscosity of water to the molecular diffusivity of oxygen in water [$S_c$ is computed from water temperature and salinity using the polynomial fit in @Wanninkhof14]. The $b$ parameter is estimated from the data and has units of $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$. As such, the three parameters estimated by EBASE are $a$, $R$, and $b$ using the required input data that includes time series of dissolved oxygen, water temperature, salinity, PAR, wind speed, and water column depth (`r run_reference(id = "tbl-ebaseiotab")`).

### Changes to BASE {#sec-basemodif}

@eq-ebase is similar to the oxygen mass balance equation in BASE [@Grace15], with the main difference being the treatment of gas exchange. The gas transfer velocity, $k_w$ (@eq-kw), increases as the water column in the vicinity of the air--water interface becomes more turbulent. As such, $k_w$ is usually modeled as a function of measurable variables that can potentially predict turbulent mixing of the surface water, e.g., wind speed, current velocity, and water depth [@Ho16]; fetch and suspended solids have also been considered for estuarine systems [@Borges11]. $k_w$ also increases with temperature because the film of water at the air-sea interface becomes thinner as the viscosity decreases and the random motion of gas molecules increases. This dependence of $k_w$ on temperature is usually modeled with the Schmidt number as in @eq-ebase, which combines information on the viscosity of the fluid and the diffusivity of the gas.

@Grace15 used the following for the gas transfer in BASE:

$$
\frac{k_w}{H} = K \cdot 1.024^{\left(T - \bar{T}\right)}
$$ {#eq-gasexbase}

where $\bar{T}$ is the average water temperature over each 24-hour period in the oxygen time series and $K$ is the reaeration coefficient estimated from the data. @eq-gasexbase indicates that $k_w$ increases with temperature and depth. The temperature dependence is consistent with the known decrease of $k_w$ with the Schmidt number, but the depth dependence is difficult to justify. An expectation is that $k_w$ would increase as water depth decreases for a given current speed because turbulence generated at the sediment--water interface by currents would more easily reach the surface [@Ho16]. Based on these differences and the lack of availability of other possible drivers of the transfer velocity in coastal systems (e.g., currents, fetch, suspended solids, and wave height), the wind-based parameterization for gas exchange was used for EBASE [@Wanninkhof14]. However, this parameterization is largely based on open-ocean data and so we allow $b$, which was esimated by @Wanninkhof14 to be 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$, to be a free parameter that may reflect spatial and temporal variability in factors other than wind and temperature that may influence transfer velocity.

BASE was also modified by removing the temperature dependence of respiration and the potential for $P$ to depend nonlinearly on PAR. While there is evidence for both dependencies in aquatic systems, we found, in preliminary model runs, that model stability was enhanced when these dependencies were removed. It would be straightforward to include such dependencies in EBASE as our understanding of them improve and as data become available that will allow them to be robustly constrained.

### EBASE model estimation {#sec-ebasemod}

The remaining three parameters $a$ (light efficiency, $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$), $R$ (respiration, $\text{mmol}/\text{m}^2/\text{d}$), and $b$ ($\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$) are estimated by likelihood given the observed data and prior distributions for the parameters. The JAGS software [as for BASE, @Plummer03] is used with the EBASE R package [described below, @Beck23; @RCT23] to estimate the unknown parameters using Markov Chain Monte Carlo (MCMC) simulations in a Bayesian framework. At each time step, the change in oxygen concentration between time steps is calculated from the equation using model inputs and parameter guesses based on the prior distributions, and then a finite difference approximation is used to estimate modeled oxygen concentration. Estimations proceed using a forward-in-time integration where the dissolved oxygen at each time step is informed by parameter estimates from the preceding time steps. The estimated dissolved oxygen concentration is also returned, which can be compared to the observed values as one measure of model performance. All parameter inputs and outputs for EBASE are shown in `r run_reference(id = "tbl-ebaseiotab")`. Areal rates for $P$, $R$, and $D$ ($\text{mmol}/\text{m}^2/\text{d}$) are returned for comparability of estimates across locations where water column depth may vary.

The metabolism estimates and their parameters returned by the Bayesian routine implemented in JAGS are affected by the prior distributions assigned to each. As for BASE, relatively uninformed prior distributions following a normal Gaussian distribution are used by default, although the priors can be changed based on previous knowledge of parameters specific to an ecosystem or as informed by other metabolic modeling approaches. Reasonable uninformed prior distributions for EBASE were chosen with mean values using approximate estimates from the literature [@caffrey2004; @Wanninkhof14] and standard deviations that were sufficiently large to allow the Bayesian routine to search an unconstrained parameter space. Specifically, the prior mean for $R$ was chosen as 300 $\text{mmol}/\text{m}^2/\text{d}$ (\~10 $\text{g O}_2/\text{m}^2/\text{d}$) using a national synthesis of metabolic rates for US estuaries [Table 2 in @caffrey2004]. Although @caffrey2004 focused on small, shallow estuaries that are part of the NERRS, this dataset is the largest, longest, and most consistently collected in the US and it is reasonable to expect others may apply EBASE to these data. The prior mean for $a$ was chosen assuming that $P$ and $R$ are comparable at long time scales, such that $aPAR$ = $R$, or $a$ = $\left(300~\text{mmol}/\text{m}^2/\text{d}\right)/PAR$. Using the global mean surface $PAR$ of 80 $W/m^2$, which is based on a global mean surface total shortwave radiation of 200 $\text{W}/\text{m}^2$ [@kiehl1997] and a $PAR$ fraction of total shortwave radiation of 0.4 [@jacovides2004], the prior mean for $a$ is reasonably set at 4 $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$. Lastly, the prior mean for $b$ was chosen as 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ following @Wanninkhof14. The prior standard deviation for $R$ was based on the standard deviation of the mean values of $R$ at the NERRS sites in @caffrey2004. The standard deviation of $R$ was 171 $\text{mmol}/\text{m}^2/\text{d}$, which was rounded to 50% of the mean, or 150 $\text{mmol}/\text{m}^2/\text{d}$. The standard deviation for $a$ was set proportionally to 2 $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$. For the prior standad deviation of $b$, we considered using the 20% error estimated for $b$ by @Wanninkhof14. However, we chose a larger value, 50%, because the wind speed-based gas transfer velocity formulation of @Wanninkhof14 was mainly developed and calibrated for open-ocean applications, where the complications of surfactants [@frew1997] and tidal currents [@Ho16], as well as fetch and suspended matter [@Borges11], are expected to be minimal. Together, the default priors for $a$, $R$, and $b$ are:

$$
a \sim N(4, 2)I(0,\infty) \;\; \left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)
$$ {#eq-aprior}

$$
R \sim N(300, 150)I(0,\infty) \;\; \text{mmol}/\text{m}^2/\text{d}
$$ {#eq-rprior}

$$
b \sim N(0.251, 0.125)I(0,0.502) \;\; \left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)
$$ {#eq-bprior}

where $N(\alpha, \beta)$ indicates a normal distribution with mean $\alpha$ and standard deviation $\beta$ and $I(\gamma, \theta)$ is 1 between $\gamma$ and $\theta$ and 0 elsewhere; $I$ has the effect of truncating the normal distribution to minimum and maximum values. All prior distributions were constrained to positive values based on known physical constraints and requirements of the model formula in @eq-ebase. Additionally, the prior distribution for $b$ was constrained to an upper limit of 0.502 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ (\~twice the default mean). Initial development of EBASE showed that using an undefined upper limit of $b$ led to unstable and unreasonable estimates for all parameters. Examples of the prior distributions in Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior] are shown in @fig-priorplot.

For ease of application, an R package was developed to implement the EBASE methods described above [@Beck23]. A detailed web page (<https://fawda123.github.io/EBASE/>) describes the required data inputs for estimating the metabolic parameters using the core R functions that pass inputs to the JAGS software. A JAGS model file is included with the package that implements @eq-ebase, with options to supply a custom model file as needed. Users can also specify alternative prior distributions from those in Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior] for each parameter. Functions are available for viewing model results, including a plot of the modeled dissolved oxygen with the observed, a time series plot of the primary metabolic estimates (P, R, and D, as areal rates with units $\text{mmol}/\text{m}^2/\text{d}$), and a time series plot of the credible intervals for the $a$, $R$, and $b$ parameters. An additional option allows the user to specify the model optimization period, where the time period can vary from a minimum of one day to the maximum of the entire length of the time series. This differs from the BASE approach where the optimization period is set at one day. Sensitivity of the EBASE method to different optimization periods is described in @sec-cmpmod. All results provided herein were generated using the EBASE R package.

## Assessment

### EBASE comparison with known results {#sec-cmpmod}

```{r}
wqmis <- misdat$Temp # same percentages across all wq parms
mtmis <- misdat$PAR # same percentages across all met parms
```

A preliminary assessment of the ability of EBASE to produce reasonable parameter estimates for $a$, $R$, and $b$ (@eq-ebase) was conducted using a synthetic time series with actual data as inputs. These assessments evaluated if 1) EBASE estimates similar values for the known parameters in the synthetic time series, and 2) how the estimated values change with different model configurations. The synthetic time series used inputs from one year of continuous data from Apalachicola Bay, Florida. The input data were observations from the year 2021 at the Cat Point water quality monitoring station (29.7021$^{\circ}$ N, --84.8802$^{\circ}$ W) and included 15-minute observations of water temperature and salinity. Continuous meteorological observations from the nearby East Bay station (29.7694$^{\circ}$ N, --84.8815$^{\circ}$ W, \~10 km north of Cat Point) were combined with the water quality data at the same time step and included air temperature, wind speed, and PAR. Missing observations in the water quality and meteorological data (`r wqmis`% and `r mtmis`% of all observations in each dataset, respectively) were filled using autoregressive modelling of the actual parameters versus time to create a complete dataset from January 1st to December 31st.

A synthetic oxygen time series was then generated using the inputs from Apalachicola Bay ([@fig-synapa]) and @eq-ebase as a forward calculating model with estimated values for $a$, $R$, and $b$. All metabolic rates for production, respiration, and gas exchange ([@fig-synapa]b and c) were also estimated with the synthetic time series. The time series was estimated using the observed data described above, the separate metabolic components and their parameters in @eq-ebase, and approximate metabolic rates from the Odum open-water method as implemented in the WtRegDO R package [@Beck21] as an approximate estimate for back-calculation of the EBASE parameters. In short, $P$, $R$, and $D$ as $\text{mmol}/\text{m}^2/\text{d}$ were estimated using the Odum method and the separate synthetic components for EBASE were created by estimating the corresponding parameters, such that $P /PAR = a$, $R$ as is, and $D = k_w\left(C_{sat} - C \right)$, where $k_w$ includes the $b$ parameter. Daily estimates for each were created as the daily average for each parameter fit with a polynomial spline to create a smoothed output. The synthetic dissolved oxygen time series was then created as the integrated sum of the separate components for $P$, $R$, and $D$ divided by water column depth. The only parameter that could not be created as a continuous time series was $b$, which was set to 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ [@Wanninkhof14]. Accordingly, the synthetic dissolved oxygen time series and the observed water quality and meteorological data were used with EBASE to determine if reasonable estimates for the known parameters and metabolic rates were recovered.

Several configurations of the EBASE model can influence how the parameters and metabolic rates are estimated. Two types of sensitivity analyses were conducted to evaluate changes in the results returned by EBASE, where in all cases, the results were compared to the known values in the synthetic time series. First, results were compared to the known values after changing characteristics of their prior distributions. Second, results were compared using a model period of optimization for one, seven, and 30 days to assess how results varied based on the amount of data used for the Bayesian estimation. Details of these analyses are as follows.

The prior distributions for the EBASE parameters follow truncated normal distributions with defined means ($\mu$) and standard deviations ($\sigma$) (Equations [-@eq-aprior], [-@eq-rprior], and [-@eq-bprior]). The sensitivity analysis evaluated changes in the distributions by varying the means and standard deviations from small to large to test the effect of changes in the central tendencies and more or less constrained ranges, respectively, on the results. Low and high values for the means and standard deviations for $R$ were assessed following reasonable ranges from @caffrey2004 using logic similar to that for choosing the default priors. The minimum and maximum mean values for $R$ were evaluated as 138 and 1009 $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$, which we rounded to $1/2$ and 3 times the mean (150 and 900 $\text{mmol}/\text{m}^2/\text{d}$) and proportionally for $a$ as 2.0 and 12 $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$. The minimum and maximum values for the standard deviations for $R$ and $a$ were chosen as 10% and 1000% of the default mean values to test a range from high precision to completely uninformed values. The mean and standard deviation for the $b$ parameter were not tested and set as the default values for all analyses given that there is minimal prior knowledge on expectations for this parameter. The default prior distribution is already uninformed and we have no appropriate expectations on methods for varying this parameter. Each unique combination of low and high values for the means and standard deviations of each parameter were evaluated, creating 2$^4$ = 16 different combinations of prior distributions that were used with the synthetic time series in EBASE.

The optimization period used for a time series determines how much data are used to estimate the three EBASE parameters ($a$, $R$, and $b$). Unlike BASE, the EBASE software allows flexibility in the period of time used for optimization, with a minimum being one day and a maximum being the length of the time series. For a chosen optimization period, single estimates for $a$, $R$, and $b$ are returned by the model. A short period of optimization (e.g., one day) may return unstable parameter estimates if forcing factors (e.g., wind, temperature) that affect estuarine biogeochemical rates occur at time scales longer the chosen period of optimization for EBASE. As such, potentially longer optimization periods may return more stable and robust estimates given that more data are used for parameter estimation, although at the risk of overgeneralizing metabolic rates if variation occurs at time scales less than the optimization period. Results from optimization periods of one, seven, and thirty days were compared for the synthetic one-year time series. Each optimization period was also evaluated for every unique combination of prior distributions, totaling 48 (16 times three optimization periods) unique analyses for the assessment of changing priors of all parameters.

Changing the prior distributions affected the ability of EBASE to return the known parameters from the synthetic time series, with results varying by optimization period. @fig-priorcomp shows a summary of the comparisons of the synthetic data with EBASE for each unique combination of prior distributions and the three optimization periods of one, seven, and thirty days. The results are shown using Nash-Sutcliffe Efficiency (NSE) values [@Nash70; @Moriasi07]:

$$
NSE = 1 - \frac{\sum\limits_{i=1}^n \left(Y_i^{Syn} - Y_i^{EBASE}\right)^2}{\sum\limits_{i=1}^n \left(Y_i^{Syn} - \bar{Y}^{Syn}\right)^2}
$$ {#eq-nse}

where $Y_i$ is the estimate from EBASE or the synthetic times series for the optimization period $i$, evaluated for each metabolic parameter, each unique combination of priors, and each optimization period. The value $n$ is the number of optimization periods in the one-year time series, i.e., $n=365$ for one day, $n \approx 52$ for seven days, and $n \approx 12$ for 30 days. All metabolic estimates were averaged within the number of days for each optimization period prior to calculating NSE values, if appropriate. The NSE value is conceptually similar to the coefficient of determination, but varies from $-\infty$ to 1. Values in the positive range from 0 to 1 are desirable with 1 being a perfect fit, whereas values in the negative range indicate the mean of the synthetic data is a better predictor than EBASE.

```{r}
# percent negative nse not do
nseall <- apasumdat %>% 
  tidyr::unnest('ests') %>% 
  filter(var != 'DO_mod') %>% 
  na.omit %>% 
  pull(nse)
perneg <- (sum(nseall < 0) / length(nseall) * 100) %>% 
  round() %>% 
  as.character() %>% 
  paste0('%')

# gasex nse
prmall <- apasumdat %>% 
  tidyr::unnest('ests') %>% 
  filter(var != 'DO_mod') %>% 
  na.omit %>% 
  summarise(
    nse = round(median(nse), 2),
    .by = var
  ) %>% 
  tibble::deframe()

# optimization nse
optnse <- apasumdat %>% 
  tidyr::unnest('ests') %>% 
  na.omit() %>% 
  filter(var != 'DO_mod') %>% 
  summarise(
    nse = round(median(nse), 2), 
    .by = ndays
  ) %>% 
  tibble::deframe()

# best mods by opt
optmod <- metsum_fun(apasumdat, 'nse', parms = T) %>% 
  filter(rnkmetsum %in% 1) %>% 
  summarise(
    metsum = round(median(metsum), 2),
    .by  = 'ndays'
  ) %>% 
  tibble::deframe()
```

Several conclusions can be made from the results in @fig-priorcomp following the patterns of the NSE values. Overall, most models regardless of optimization period or priors were able to reproduce the dissolved oxygen time series. The only models where the NSE values were less than zero for dissolved oxygen were those where $\sigma$ of the $R$ parameter was low. However, substantial variation in NSE values was observed among all other parameters. Not considering dissolved oxygen, gas exchange ($D$) was estimated with the highest NSE, with a median value across all optimization periods and priors slightly larger than zero (median NSE = `r prmall[['D']]`). Conversely, the $a$ parameter was reproduced the most poorly, with a median value across all optimization periods and priors less than zero (median NSE = `r prmall[['a']]`). By optimization period, median NSE values across all parameters decreased slightly as the number of days used for model optimization increased (1 day = `r optnse[['1']]`, 7 days = `r optnse[['7']]`, 30 days = `r optnse[['30']]`). The top three ranked models were identical for the seven and thirty day models and similar for models using the one day optimization period. Median NSE values across parameters for the top model in each optimization period were also similar (1 day = `r optmod[['1']]`, 7 days = `r optmod[['7']]`, 30 days = `r optmod[['30']]`). For the seven day and thirty day optimization periods, the NSE values for all parameters were greater than zero for the top models, where two of the parameters in the top model for the one day optimization period has NSE \< 0. Most parameters regardless of optimization period or priors had NSE \< 0 (`r perneg`). As such, the prior combinations that produced the highest NSE values across all parameters were those where the $\sigma$ values were high for each prior distribution, regardless of the values for $\mu$, i.e., those with sufficient flexibility to search a larger parameter space regardless of $\mu$ produced metabolic parameter estimates most similar to the known values from the synthetic time series.

@fig-priorsumcomp provides an alternative summary of how the prior distributions influenced the ability of EBASE to reproduce the synthetic parameters. Median NSE values across all models, parameters, and each optimization period for the different subsets of the prior combinations are shown relative to the grand median NSE value across all comparisons. For example, the bottom left panel with the x-axis value for the $a$ parameter shows the difference in the median NSE values for all models using a one-day optimization period where the $\sigma$ value for the $a$ prior distribution was low or high. The size of the points indicate the inter-quartile range of NSE values for each subset. As such, each set of points denoted by the x-axis parameters in each panel include median NSE values for all models by optimization period, but subset by the low/high $\mu$ or $\sigma$ values for each parameter. Positive values indicate relative performance greater than the overall median NSE values and negative values indicate relative performance worse than the overall median. Dissolved oxygen was generally modeled with high accuracy for all priors and it was excluded to not skew the assessment. The patterns suggest that EBASE results are more sensitive to changes in the $\sigma$ parameter as shown by the larger spread in the median results compared to those for $\mu$. This result is especially true for the priors of the $a$ and $R$ parameters. Conversely, model results are less sensitive to low or high values for $\mu$ as the spread between median NSE values is less than those for $\sigma$. This suggests that EBASE model sensitivity is most influenced by $\sigma$ of the prior distributions, i.e., larger values produce more accurate and less variable estimates regardless of $\mu$. Patterns by optimization period were not apparent.

The actual model results for the best and worst performing combinations of prior distributions for the one day, seven day, and thirty day optimization periods are shown in @fig-optex (all results are averaged at the time-step of the optimization period for comparability). The best performing models were those with the highest median NSE values across all parameter estimates in @fig-priorcomp. The best performing models for each optimization period (@fig-optex a, c, e) showed similar results where the parameter estimates were similar to the synthetic time series, although more variation in the EBASE results were of course observed with the one day optimization period. However, the $b$ parameter was estimated with high variability for the one and seven day optimization periods (@fig-optex a, c, bottom row) and with a large positive bias for the 30 day optimization period (@fig-optex e, bottom row). These results were not unexpected because it was impossible to evaluate NSE estimates using a fixed value in the synthetic results and the accuracy was not considered in identifying the best performing model. Finally, the worst performing model for each optimization period (@fig-optex b, d, f) demonstrates the negative NSE values that were obtained (i.e., EBASE values much lower or higher than the synthetic values). The worst performing models were caused by constraining EBASE to a small parameter space using low or high values for $\mu$ combined with low values for $\sigma$.

As a final evaluation of EBASE to return known metabolic parameters, a second synthetic time series was created that added estimated effects of instrument and tidal noise to the original synthetic time series. The objective of the analysis is to develop an expectation of how metabolic estimates may change using in situ data with noise that may substantially mask a biological signal in dissolved oxygen measurements. The instrument and tidal noise were estimated using a weighted regression analysis [@Beck15; @Beck21] on actual observed dissolved oxygen time series for Apalachicola Bay using data from 2021. This approach models dissolved oxygen as a function of time, salinity, and season using a moving window approach with weights of the independent variables appropriate for each time period within the windows. The results of this analysis return a predicted and detided dissolved oxygen time series. The instrument noise was estimated as the difference between the observed and predicted time series and the tidal noise was estimated as the difference between the predicted and detided time series. Both the instrument and tidal noise were added to the original synthetic time series above (@fig-synapanos). EBASE was then used with unconstrained priors (large $\sigma$) on the synthetic time series with noise, then compared with results from the original synthetic time series.

@fig-synapanoscmp shows the comparison of the EBASE results for the synthetic time series with instrument and tidal noise to those from the original synthetic time series. Results for both time series produced similar dissolved oxygen estimates (top-left panel, @fig-synapanoscmp), although notable differences were observed in the remaining parameters. In particular, gross primary production (P) and ecosystem respiration (R) were generally higher and more variable for results from the noisy time series, with differences in the former attributed to higher estimates in the $a$ parameter. As for the previous results, the $b$ parameter was estimated with low precision for both input time series, although results were centered around the true value of 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$. Gas exchange (D) was similar between the input time series, suggesting that lack of precision in the $b$ parameter had a minimal influence regardless of noise.

### EBASE and Odum comparison with real observations

Metabolic estimates from EBASE were further compared to those from existing methods to benchmark and evaluate potential differences from alternative model formulations used by each approach. The observed one-year continuous time series described above for water quality and weather data from Apalachicola Bay was used to compare metabolic estimates from EBASE and the Odum open-water method [@Odum56]. The Odum method used an approach described in @Murrell18 created for estuarine application that uses a gas-exchange approach from @Thebault08. For a better comparison with the EBASE methods, the gas exchange parameterization in the Odum method was modified to use the @Wanninkhof14 approach and the $b$ parameter was fixed at 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ [as available in the WtRegDO R package, @Beck21]. An additional and fundamental difference between EBASE and the Odum method is that the former is likelihood based with metabolic rates estimated by fitting the model to the data, whereas the latter is strictly arithmetic based primarily on integration of the diel dissolved oxygen curve. Thus, potentially different results are expected between the approaches based on differences in formulation of the mass balance equations for metabolism, as well as alternative statistical approaches to estimating the parameters. Each comparison also evaluated differences in the metabolic estimates using the observed dissolved oxygen time series and a detided time series using weighted regression [@Beck15; @Beck21]. The latter comparison provided an assessment of metabolic rates that are expected to be minimally influenced by tidal advection, as a fundamental assumption of metabolic models using *in situ* dissolved oxygen time series from fixed monitoring stations. The prior distributions for EBASE were uninformed using the same large $\sigma$ values from @sec-cmpmod and moderate $\mu$ values ($\mu$ = 0.2 $\left(\text{mmol}/\text{m}^2/\text{d}\right)/\left(\text{W}/\text{m}^2\right)$ for $a$, $\mu$ = 20 $\text{mmol}/\text{m}^3/\text{d}$ for $R$, $\mu$ = 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$ for $b$). A one day model optimization period was used for EBASE for comparability with the Odum method.

The common set of metabolic parameters returned by the EBASE and Odum methods are net ecosystem metabolism (NEM), gross primary production (P), ecosystem respiration (R), and gas exchange (D). Pairwise comparisons of the daily estimates returned by each method were evaluated using simple summary statistics, including Pearson correlation coefficients ($\rho$) and root mean square errors (RMSE) of the linear regression fit comparing the same metabolic parameter between methods. Results were assessed separately for estimates using the observed or detided dissolved oxygen time series.

@fig-apacmpfig and `r run_reference(id = "tbl-apacmptab")` provide a comparison of the metabolic estimates from the EBASE and Odum methods. Correlations for all metabolic estimates, regardless of the input time series, were positive and significantly correlated, as expected. However, correlations were generally stronger for the metabolic results based on the detided dissolved oxygen time series. The only exception for the correlation estimates was gas exchange (D), which had a slightly weaker correlation using the detided results. @fig-apacmpfig shows that the Odum results for gas exchange were more variable than those for EBASE using the detided dissolved oxygen, where the latter often estimated gas exhange at much smaller values compared to the former. The RMSE values of each regression comparing the metabolic estimates between methods were generally lower in the detided results, excluding D which was higher with the detided dissolved oxygen relative to the observed.

The comparisons in @fig-apacmpfig and `r run_reference(id = "tbl-apacmptab")` suggest that tidal effects on continuous monitoring data can severely violate assumptions required for methods of estimating ecosystem metabolism [as described in detail in @Beck15]. These effects are easily identified by stronger correlations and lower RMSE using the detided dissolved oxygen. Further, effects of tidal advection can be seen with estimates from the Odum method as negative values for P and R, i.e., "anomalous" values. The effects of tidal advection on estimates from EBASE were more subtle as anomalous values cannot be returned based on constraints of the priors (i.e., none can be negative), although the range of values for the metabolic estimates were much larger with observed dissolved oxygen. A similar result (larger estimates for P and R) was observed using the synthetic time series with instrument and tidal noise (@fig-synapanoscmp). Overall, the results suggest that detiding the dissolved oxygen time series prior to estimating metabolic rates reduces tidal noise and produces more stable estimates with smaller ranges, regardless of the method used.

## Discussion

The above analyses demonstrated that EBASE can successfully recover known metabolic parameters from a synthetic time series and provides robust estimates on real data covering a year of observations. The success of these results was predicated on the requirements of EBASE to address several critical needs that existing methods for estimating metabolism do not address for coastal applications. These needs were addressed by 1) using a Bayesian framework that estimates the best fit of the model to the data with posterior probabilities describing the likelihood of the fit, and 2) modifying the underlying mass-balance model for dissolved oxygen with several components more appropriate for estuarine settings. First, the Bayesian framework enables hypothesis testing of how a model can be fit to data by using prior knowledge in the model fitting process, which results in posterior probabilities describing the certainty of the parameter estimates [@Hilborn13]. The advantages of the Bayesian approach have led to widespread adoption over frequentist approaches in many scientific applications, especially in the coastal and marine community [e.g., @myers2001; @borsuk2001; @brown2017], yet these methods have not been rigorously explored for estimating metabolic rates in estuaries. Our results demonstrated that even using uninformed priors, EBASE can reproduce known metabolic parameters and rates with reasonable certainty. However, an exception was the ability of the model to estimate stable values for the $b$ parameter, although the resulting estimate of gas exchange was similar to the known values. This result could be explained by the dominance of the relative processes that manifest signals in the dissolved oxygen time series. That is, estuarine dissolved oxygen at Apalachicola Bay may be dominated by production and respiration, and less so from gas exchange, such that the available data provided insufficient information for EBASE to estimate $b$. This result aligns with others that have suggested gas exchange may be a relatively small component of the metabolic signal in shallow estuaries of the Gulf of Mexico [@Murrell18]. In such cases, more constrained prior distributions for $b$ could be appropriate or EBASE could be tested in settings with expected larger contributions of gas exchange expressed by dissolved oxygen.

The second advantage of EBASE that makes the model more appropriate for estuarine settings included several modifications to the underlying mass-balance equation for dissolved oxygen (@eq-ebase). As described in @sec-basemodif, EBASE is an estuarine adaptation of BASE [@Grace15] that was developed for stream applications and many assumptions of the underlying model of the latter were inappropriate for the former. Specifically, EBASE was modified to address three primary concerns of using BASE in an estuarine setting. First, the estimation of gross primary production as a function of PAR assumed a linear relationship such that the increase of production per unit increase of PAR was consistent for any level of the latter. The BASE model includes an exponential parameter, $p$, that defines a non-linear relationship between P and PAR (although it should be noted that BASE provides an option to set $p = 1$). @Holtgrieve10 describes a simple linear photosynthesis-irradiance curve as appropriate for systems that are never light-saturated and this assumption likely holds true for estuaries that are commonly more turbid than open-ocean or freshwater locations. Second, EBASE removed the temperature-dependency of respiration and assumed that respiration did not change with water temperature, consistent with applications of the Odum method to other shallow estuaries [@Beck15; @Murrell18]. This modification addresses recent work that suggests respiration in streams may be reduced during the night with lower temperatures as the respiration of labile autochthonous organic matter may contribute to changes in the dissolved oxygen time series [@sadro2014; @schindler2017]. There is currently no justification for this assumption in estuaries. Finally, the gas exchange in EBASE used the parameterization in @Wanninkhof14 that is primarily wind-based and developed for the open-ocean, which is clearly more appropriate than the prior formulation in BASE that includes a temperature and depth dependency for streams. Overall, these changes also reduced the required inputs and many monitoring locations nationwide include the requisite data for applying EBASE (i.e., dissolved oxygen, water temperature, salinity, PAR, and wind speed, as collected by the NERRS).

Our results also confirmed that the effects of tidal advection on metabolic estimates can lead to biases in understanding gross primary production and ecosystem respiration. This result has previously been shown using the Odum open water method [@kemp1980; @caffrey2003; @Beck15] and confirmed herein, whereby results using observed time series can produce over-estimates of metabolic rates with more variation than those without tidal influence. Our assessment of the synthetic time series with noise and use of the detided dissolved oyxgen time series from the observed data at Apalachicola Bay to estimate metabolism both demonstrated this bias (Figures [-@fig-synapanoscmp] and [-@fig-apacmpfig]). As a result, detiding dissolved oxygen data is recommended prior to estimating metabolism, regardless of whether EBASE or an alternative method is used. In addition to inaccurate and imprecise metabolic estimates, tidal influences are also most likely observed as negative (or anomalous) values in the production and respiration rates using the Odum method [@caffrey2003]. Tidal effects may be less obvious using EBASE since negative values cannot be obtained based on constraints of the prior distributions, although as noted above, larger and more variable estimates are returned. A potential future approach for developing EBASE could be an explicit formulation of tidal advection in the model using a synoptic tidal height time series in the Bayesian framework. This has the advantage of simultaneously detiding and estimating metabolic rates using the same model, whereas using weighted regression prior to EBASE, as used herein, requires additional analysis and assumptions. However, field measurements [e.g., control volume approaches, @falter2008; @nidzieko2014] may be required to provide reasonable constraints on the prior distributions for any parameters that quantify advective influences on dissolved oxygen.

EBASE provides several computational advantages over BASE implemented in the R package that was created for the purposes herein [@Beck23]. Most importantly, EBASE was developed to allow different model optimization lengths, whereas the BASE method was developed to estimate results for a single day. Allowing EBASE to incorporate more than a day of observations in the optimization can likely produce more accurate and precise estimates for the metabolic parameters. Physical and biological characteristics of an ecosystem that affect the metabolic rates are likely acting at time scales longer than a day, e.g., wind patterns that can affect gas exchange as quantified by the $b$ parameter may persist for several days. Exposing the model to additional observations may produce more stable results as the parameters for the best fit are estimated by the Bayesian routine as a function of the data that are evaluated each optimization period. However, we cannot provide a precise recommendation on the number of days to use for the optimization period as the exact length of time that ecosystem characteristics can affect metabolic rates may not be known and likely varies by location. Our example using the synthetic time series from Apalachicola Bay suggests that results were similar for the 7 and 30 day optimization period. As such, using one week of data for each optimization period is likely appropriate for this location. For other locations, using one day is not recommended given the issues stated above (i.e., unstable results), whereas an optimization period longer than a month may miss important events in the time series that can affect the metabolic estimates and will likely produce parameters that are overly generalized.

The EBASE R package can also accommodate missing observations in the input data. This allows the estimation of metabolic rates for time series that cover relatively long periods of time (e.g., more than year), when data gaps are likely to occur for several reasons (e.g., equipment malfunction, routine maintenance, etc.). The R package accommodates data gaps using linear interpolation for any required input used by EBASE. This allows the Bayesian routine to provide continuous estimates across the time series. The results are then automatically post-processed to remove any metabolic estimates that exceed a threshold for the number of interpolated observations. The analyst can determine the appropriate length of time to use for excluding results based, although the default setting for EBASE is 12 hours, where results for an entire optimization period are removed if any interpolated period exceeded 12 hours within that period. Although this does not apply to the synthetic time series, some of the estimates using the 2021 observed data for Apalachicola Bay were excluded from the analysis. This feature allows EBASE to be applied more easily to other data sets because an analyst does not need to manually screen data that include missing values prior to analysis.

While the EBASE theory and software provide advantages for metabolic estimates, the approach is not without limitations. Like most models, explicit choices are needed to apply EBASE to time series data. First, the use of unconstrained prior distributions was shown to reproduce known metabolic parameters with reasonable certainty, although the $b$ parameter was still relatively unstable and unconstrained priors may not provide useful estimates in estuarine settings outside of the location evaluated herein. This may require further constraining the priors, although doing so may produce biased results in the absence of additional data to justify a constraint. Field-based measurements or alternative metabolic models could be used for informing priors. As an example, initial application of BASE to estuarine data prior to developing EBASE demonstrated that unstable and unrealistic metabolic rates were returned with uninformed priors. The Odum method was used on the same data to develop an appropriate expectation of the range of values for the reaeration coefficient, $K$, which was then used to inform the prior distribution using the BASE method. More stable and realistic metabolic estimates were then returned by BASE, demonstrating the value of the Bayesian approach that can incorporate prior knowledge. A similar approach could be applied to create more accurate estimates from EBASE depending on location. An additional choice for using EBASE is the model optimization period, although some guidance is provided above.

A final limitation of EBASE is the relatively long processing time when applying the method to a time series longer than a few days. For example, the execution time applying EBASE to a year of data on a conventional laptop computer was approximately 40 minutes, depending on the model settings. This time is compared to the Odum method applied to the same dataset, where results are obtained in a matter of seconds. Given the Bayesian framework used by EBASE, not considering the additional statistical advantages, it is not reasonable to expect comparable processing times between the methods. Regardless, computation times could be reduced with additional hardware improvements (e.g., accessing multiple processing cores) or changing the model estimation methods (e.g., reducing the number of MCMC simulations used by JAGS), although the latter may negatively affect model accuracy.

## Comments and Recommendations

The development of EBASE represents a new approach for estimating metabolic rates in estuarine settings that leverages existing methods by adapting theoretical components of the underlying mass-balance model using a Bayesian framework. Our results have demonstrated that unknown metabolic parameters can be estimated with reasonable certainty using uninformed prior distributions and EBASE could be a valuable approach to improve the understanding of critical ecosystem processes as the method can be readily applied to other settings. A notable limitation of EBASE was an inability to precisely recover the $b$ parameter from a synthetic time series, although this result may be explained by a minimal contribution of gas exchange as expressed in the dissolved oxygen time series. Effects of tidal advection on dissolved oxygen measurements were also observed, demonstrating a violation of the assumption that the measured data represent a water sample having a continuous metabolic history. Further development of EBASE to accommodate a tidal signal, or exploring alternative methods for detiding dissolved oxygen data, are promising avenues of future research to more accurately quantify metabolic parameters in estuaries. Overall, EBASE represents a potentially powerful tool that removes many of the assumptions of existing methods by allowing unknown metabolic parameters to be estimated by the data and can also incorporate existing knowledge for further exploration of estuarine ecosystem properties.

## Acknowledgments {.unnumbered}

We thank Jason Garwood and Ethan Borque of the Apalachicola National Estuarine Research Reserve for assisting with the deployment and processing of data used herein. We also thank Wade McGillis for assisting in this effort. We thank Darren Giling for initial conversations on applying BASE to estuarine data. This research was funded by award 1924559 from the National Science Foundation to co-PIs Ray Najjar, Maria Herrmann, and Kathleen Hill.

{{< pagebreak >}}

## Figures {.unnumbered}

![The default prior distributions for $a$, $R$, and $b$ used in EBASE. All priors are normal distributions and truncated to positive values. $b$ is also truncated to a maximum of 0.502 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$.](figs/priorplot.png){#fig-priorplot fig-align="center"}

{{< pagebreak >}}

![Synthetic time series for one year of continuous data at Apalachicola Bay. Synthetic input to EBASE was the (a) dissolved oxygen time series, with results compared to the (b) synthetic $a$ parameter and (c) synthetic metabolic estimates for gross primary production ($P$), the negative of ecosystem respiration ($-R$), and gas exchange ($-D$).](figs/synapa.png){#fig-synapa}

{{< pagebreak >}}

![Comparison of EBASE results to a synthetic time series created with known model parameters. ($a$, $R$, and $b$). Results are compared for unique combinations of prior distributions and optimization period. The means ($\mu$) and standard deviations ($\sigma$) are evaluated as low (L) or high (H) values (see text for details) and the optimization period for EBASE is one day, seven days, or thirty days. The model predictions of dissolved oxygen (DO), gross primary production (P), ecosystem respiration (R), gas exchange (D), and the $a$ parameter are evaluated based on Nash-Sutcliffe Efficiency (NSE) values between the EBASE results and synthetic values. NSE values from zero to one (green) indicate EBASE has some skill in recovering the synthetic values of DO, $D$, $P$, $R$ , and $a$, with values closer to 1 being a better approximation, whereas negative values indicate no skill. The color scale for NSE is also exponentially transformed to minimize the influence of large negative values on the visual display. The $b$ parameter is a fixed constant and was not evaluated. Rankings of each combination as the median NSE value across all five model outputs in a row are shown on the right, with the top three as black/bold and bottom three as black/italic.](figs/priorcomp.png){#fig-priorcomp}

{{< pagebreak >}}

![Summaries of % change in Nash-Sutcliffe Efficiency (NSE) values across all the comparisons of EBASE and the five synthetic model outputs separated by different combinations of prior values. Summaries are shown relative to the change from the median for each comparison group (i.e., optimization period and prior parameter, $n$ = 32). Each result on the x-axis represents the median values for which the combination prior applies. For example, the points in the upper left panel that are fartheset to the left summarize the results from @fig-priorcomp where $\mu$ is high or low for the $a$ parameter using a one day optimization period. Point size represents the inter-quartile range of median NSE values for each result ($n$ = 8) .](figs/priorsumcomp.png){#fig-priorsumcomp}

{{< pagebreak >}}

![Comparison of EBASE results for the best and worst performing models to a synthetic time series created with known metabolic parameters. The best and worst performing models for the one day (a, b), seven day (c, d), and thirty day (e, f) optimization periods are based on the EBASE results with prior distributions that produced the highest and lowest median Nash-Sutcliffe Efficency values across all parameter estimates (@fig-priorcomp). The results are averaged at the time step of the model optimization period. The $b$ parameter is fixed at 0.251 $\left(\text{cm}/\text{hr}\right)/\left(\text{m}^2/\text{s}^2\right)$.](figs/optex.png){#fig-optex fig-align="center"}

{{< pagebreak >}}

![A subset of the synthetic time series and the synthetic time series with noise for evaluating the ability of EBASE to recover known metabolic parameters. The original synthetic time series and the same time series with instrument and tidal noise is shown in (a) and the estimated instrument and tidal noise is shown in (b).](figs/synapanos.png){#fig-synapanos fig-align="center"}

{{< pagebreak >}}

![Comparisons of EBASE to recover parameters $a$ (top) and $R$ (bottom) from a synthetic time series and a synthetic time series with residual and tidal noise included. The left plots show the time series and the right plots show a 1:1 comparison for each result. See @fig-synapanos for an example of the dissolved oxygen for both input time series.](figs/synapanoscmp.png){#fig-synapanoscmp fig-align="center"}

{{< pagebreak >}}

![Comparisons of daily metabolic estimates from the EBASE and Odum methods for one year of continuous monitoring data at Apalachicola Bay. Results for (a) gross primary production ($P$), (b) ecosystem respiration ($R$), and (c) net ecosystem metabolism ($NEM$) are compared using the observed and detided dissolved oxygen time series as input to each model. All values are areal as mmol O$_2$ m$^2$ d$^{-1}$. Black lines show the 1:1 comparison and the red lines show the linear regression fit.](figs/apacmpfig.png){#fig-apacmpfig fig-align="center"}

{{< pagebreak >}}

<!-- {{< pagebreak >}} -->

## Tables {.unnumbered}

```{r}
#| label: tbl-ebaseiotab
#| tbl-cap: "EBASE model parameters showing the required input, parameters derived from the model input, and model output.  The model notation for production, respiration, and gas exchange shows both the simple parameter name and the full model component used to estimate the parameter."
ebaseiotab
```

{{< pagebreak >}}

```{r}
#| label: tbl-apacmptab
#| tbl-cap: "Summary statistics of daily metabolic estimates comparing the EBASE and Odum methods for net ecosystem metabolism (NEM), gross primary production (P), respiration (R), and gas exchange (D). Separate comparisons are made for estimates based on observed and detided dissolved oxygen. Summary statistics include Pearson correlation coefficients and root mean square error (RMSE) of a linear fit between the same metabolic estimates obtained from each method."
apacmptab
```

{{< pagebreak >}}

## References {.unnumbered}
